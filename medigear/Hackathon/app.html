<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MediGear Dashboard - Complete Health Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --soft-lavender-blue: #C7D2FE;
            --misty-sky-blue: #DFF6FF;
            --pale-aqua: #E6FAF5;
            --blush-pink: #F5D0FE;
            --off-white: #FAFAFF;
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-bg-light: rgba(255, 255, 255, 0.2);
            --glass-bg-medium: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.25);
            --glass-border-light: rgba(255, 255, 255, 0.15);
            --text-dark: #1F2937;
            --text-medium: #4B5563;
            --text-light: #6B7280;
            --accent-color: #6366F1;
            --glass-shadow: rgba(0, 0, 0, 0.05);
            --glass-blur: blur(20px);
            --success-color: #10B981;
            --warning-color: #F59E0B;
            --danger-color: #EF4444;
            --info-color: #3B82F6;
        }

        /* Prevent zoom on mobile */
        html {
            overflow-x: hidden;
            width: 100%;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        /* Animated Background */
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }

        .bg-animation {
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                rgba(199, 210, 254, 0.15) 0%,
                rgba(245, 208, 254, 0.1) 25%,
                rgba(223, 246, 255, 0.2) 50%,
                rgba(230, 250, 245, 0.15) 75%,
                rgba(199, 210, 254, 0.1) 100%
            );
            animation: gradientShift 15s ease infinite;
            transform-origin: center;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .floating-shape {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: float 20s infinite linear;
        }

        .shape-1 {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 5%;
            animation-delay: 0s;
            background: radial-gradient(circle, rgba(199, 210, 254, 0.2) 0%, rgba(199, 210, 254, 0) 70%);
        }

        .shape-2 {
            width: 200px;
            height: 200px;
            top: 60%;
            right: 10%;
            animation-delay: -5s;
            animation-duration: 25s;
            background: radial-gradient(circle, rgba(245, 208, 254, 0.15) 0%, rgba(245, 208, 254, 0) 70%);
        }

        .shape-3 {
            width: 400px;
            height: 400px;
            bottom: 10%;
            left: 20%;
            animation-delay: -10s;
            animation-duration: 30s;
            background: radial-gradient(circle, rgba(223, 246, 255, 0.1) 0%, rgba(223, 246, 255, 0) 70%);
        }

        .shape-4 {
            width: 150px;
            height: 150px;
            top: 20%;
            right: 20%;
            animation-delay: -15s;
            animation-duration: 20s;
            background: radial-gradient(circle, rgba(230, 250, 245, 0.15) 0%, rgba(230, 250, 245, 0) 70%);
        }

        .pulse-dots {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .pulse-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--soft-lavender-blue);
            animation: pulse 3s infinite;
        }

        .dot-1 { top: 30%; left: 15%; animation-delay: 0s; }
        .dot-2 { top: 70%; right: 20%; animation-delay: 0.5s; background: var(--blush-pink); }
        .dot-3 { bottom: 40%; left: 30%; animation-delay: 1s; background: var(--misty-sky-blue); }
        .dot-4 { top: 40%; right: 30%; animation-delay: 1.5s; background: var(--pale-aqua); }
        .dot-5 { bottom: 20%; right: 40%; animation-delay: 2s; background: var(--soft-lavender-blue); }

        @keyframes gradientShift {
            0%, 100% {
                transform: rotate(0deg) scale(1);
            }
            25% {
                transform: rotate(90deg) scale(1.1);
            }
            50% {
                transform: rotate(180deg) scale(1);
            }
            75% {
                transform: rotate(270deg) scale(1.1);
            }
        }

        @keyframes float {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(100px, 50px) rotate(90deg);
            }
            50% {
                transform: translate(50px, 100px) rotate(180deg);
            }
            75% {
                transform: translate(-50px, 50px) rotate(270deg);
            }
            100% {
                transform: translate(0, 0) rotate(360deg);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.6;
            }
        }

        /* Loading Screen Styles */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--off-white) 0%, var(--misty-sky-blue) 50%, var(--pale-aqua) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 50px;
        }

        .loading-logo i {
            font-size: 4rem;
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s infinite;
        }

        .loading-logo h1 {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-dark);
            letter-spacing: -1px;
        }

        .loading-spinner-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--glass-border);
            border-top-color: var(--soft-lavender-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            color: var(--text-medium);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: var(--glass-bg);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--soft-lavender-blue), var(--blush-pink));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--off-white) 0%, var(--misty-sky-blue) 50%, var(--pale-aqua) 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            margin: 0;
            padding: 0;
            padding-bottom: 100px; /* Space for bottom nav */
        }

        /* Glassy App Header */
        .app-header {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: var(--glass-bg-medium);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px var(--glass-shadow);
            box-sizing: border-box;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .logo i {
            font-size: 24px;
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo h1 {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--text-dark);
            letter-spacing: -0.5px;
            white-space: nowrap;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: nowrap;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-dark);
            border: 2px solid var(--glass-border);
            flex-shrink: 0;
        }

        /* NEW: BOTTOM NAVIGATION BAR */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 600px;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 35px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 20px;
            z-index: 1001;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .nav-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 10px;
            border-radius: 20px;
            min-width: 60px;
        }

        .nav-item i {
            font-size: 22px;
            color: #666;
            transition: all 0.3s ease;
        }

        .nav-item span {
            font-size: 11px;
            color: #666;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .nav-item:hover i,
        .nav-item:hover span {
            color: var(--accent-color);
            transform: translateY(-2px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
        }

        .nav-item.active i,
        .nav-item.active span {
            color: white;
        }

        /* CENTER ADD BUTTON */
        .nav-item.add-btn {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #10B981, #059669);
            border-radius: 50%;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            position: relative;
            top: -15px;
        }

        .nav-item.add-btn i {
            font-size: 28px;
            color: white;
        }

        .nav-item.add-btn span {
            display: none;
        }

        .nav-item.add-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.5);
        }

        /* Symptom Checker Styles */
        .symptom-steps {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            gap: 0;
        }

        .symptom-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--glass-bg);
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s ease;
            border: 2px solid var(--glass-border);
        }

        .symptom-step.active {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
            border-color: var(--accent-color);
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .symptom-bar {
            height: 2px;
            width: 50px;
            background: var(--glass-border);
            transition: all 0.3s ease;
        }

        .symptom-bar.active {
            background: linear-gradient(90deg, var(--soft-lavender-blue), var(--blush-pink));
        }

        .symptom-group {
            margin-bottom: 25px;
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .symptom-pill {
            padding: 12px 16px;
            text-align: center;
            border: 2px solid var(--glass-border);
            border-radius: 25px;
            background: var(--glass-bg);
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-dark);
            font-weight: 500;
            user-select: none;
        }

        .symptom-pill:hover {
            background: var(--glass-bg-light);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .symptom-pill.selected {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
            border-color: var(--accent-color);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .urgency-badge {
            display: inline-block;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        .urgency-mild {
            background: rgba(16, 185, 129, 0.2);
            color: #065f46;
            border: 1px solid rgba(16, 185, 129, 0.5);
        }

        .urgency-moderate {
            background: rgba(245, 158, 11, 0.2);
            color: #92400e;
            border: 1px solid rgba(245, 158, 11, 0.5);
        }

        .urgency-severe {
            background: rgba(239, 68, 68, 0.2);
            color: #991b1b;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }

        .urgency-emergency {
            background: rgba(239, 68, 68, 0.3);
            color: #7f1d1d;
            border: 1px solid rgba(239, 68, 68, 0.7);
        }

        .diagnosis-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .diagnosis-item:hover {
            border-color: var(--accent-color);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.1);
        }

        .diagnosis-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 1.05rem;
        }

        .diagnosis-remedies {
            color: var(--text-medium);
            font-size: 0.95rem;
            margin-top: 12px;
        }

        .diagnosis-remedies li {
            margin-bottom: 6px;
        }

        /* Settings and Logout Buttons */
        .header-buttons {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .settings-btn, .logout-btn {
            padding: 8px 16px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-dark);
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: var(--glass-blur);
            border: none;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            flex-shrink: 0;
            font-size: 0.9rem;
        }

        .settings-btn:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
        }

        .logout-btn:hover {
            background: var(--danger-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.2);
        }

        /* Toggle Button for Navbar - ALWAYS VISIBLE */
        .navbar-toggle {
            position: fixed;
            top: 90px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: var(--glass-bg-medium);
            backdrop-filter: var(--glass-blur);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 901;
            cursor: pointer;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px var(--glass-shadow);
            transition: all 0.3s ease;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .navbar-toggle:hover {
            transform: scale(1.1);
            background: var(--glass-bg);
        }

        .navbar-toggle i {
            font-size: 1.2rem;
            color: var(--text-dark);
            transition: transform 0.3s ease;
        }

        .navbar-toggle.active i {
            transform: rotate(180deg);
        }

        /* Glassy Collapsible Navbar - FIXED with separate scrolling */
        .navbar {
            position: fixed;
            top: 150px;
            left: 30px;
            width: 220px;
            height: calc(100vh - 180px);
            border-radius: 24px;
            background: var(--glass-bg-medium);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            padding: 20px;
            z-index: 900;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            transform: translateX(-100%);
            opacity: 0;
            display: flex;
            flex-direction: column;
        }

        .navbar.active {
            transform: translateX(0);
            opacity: 1;
        }

        .navbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--soft-lavender-blue), 
                var(--blush-pink), 
                transparent
            );
            opacity: 0.6;
        }

        .nav-links {
            list-style: none;
            margin: 0;
            padding: 0;
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
            padding-right: 10px;
        }

        .nav-links::-webkit-scrollbar {
            width: 6px;
        }

        .nav-links::-webkit-scrollbar-track {
            background: var(--glass-bg);
            border-radius: 3px;
        }

        .nav-links::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            border-radius: 3px;
        }

        .nav-links::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--blush-pink), var(--soft-lavender-blue));
        }

        .nav-links li {
            margin-bottom: 6px;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--text-dark);
            text-decoration: none;
            border-radius: 14px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            background: transparent;
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
            font-size: 0.95rem;
        }

        .nav-links a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
            border-radius: 14px;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--text-dark);
            transform: translateX(6px);
            border-color: var(--glass-border);
            background: var(--glass-bg-light);
        }

        .nav-links a:hover::before, .nav-links a.active::before {
            opacity: 0.1;
        }

        .nav-links i {
            margin-right: 10px;
            font-size: 18px;
            width: 20px;
            text-align: center;
            color: var(--text-medium);
            transition: all 0.3s ease;
        }

        .nav-links a:hover i, .nav-links a.active i {
            color: var(--text-dark);
            transform: scale(1.1);
        }

        /* Main Content */
        .main-content {
            margin-left: 0;
            padding: 100px 30px 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: margin-left 0.4s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .main-content.with-navbar {
            margin-left: 280px;
        }

        .dashboard-container {
            max-width: 1400px;
            width: 100%;
        }

        /* Welcome Section - FULL WIDTH */
        .welcome-section {
            background: var(--glass-bg-medium);
            backdrop-filter: var(--glass-blur);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .welcome-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
                var(--soft-lavender-blue), 
                var(--blush-pink),
                var(--pale-aqua)
            );
        }

        .welcome-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
        }

        .welcome-text {
            position: relative;
            z-index: 1;
            flex: 1;
            min-width: 400px;
        }

        .welcome-text h2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--text-dark), var(--text-medium));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .welcome-text p {
            font-size: 1.1rem;
            color: var(--text-medium);
            max-width: 800px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .welcome-stats {
            position: relative;
            z-index: 1;
            flex: 1;
            min-width: 400px;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            width: 100%;
        }

        @media (min-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Health Check Card */
        .health-check-card {
            background: var(--glass-bg-medium);
            backdrop-filter: var(--glass-blur);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            height: fit-content;
        }

        .health-check-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 10px 30px rgba(199, 210, 254, 0.3);
            flex-shrink: 0;
        }

        .card-title h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .card-title p {
            color: var(--text-medium);
            font-size: 0.95rem;
        }

        /* Mood Selection */
        .mood-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .mood-btn {
            padding: 15px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            backdrop-filter: var(--glass-blur);
        }

        .mood-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: transparent;
        }

        .mood-btn.selected {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
            border-color: transparent;
        }

        .mood-emoji {
            font-size: 1.8rem;
        }

        .mood-name {
            font-size: 0.85rem;
        }

        /* Health Tips */
        .health-tips {
            margin-top: 20px;
        }

        .health-tip {
            background: var(--glass-bg);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: fadeIn 0.5s ease;
        }

        .health-tip i {
            color: var(--soft-lavender-blue);
            font-size: 1.1rem;
            min-width: 25px;
            margin-top: 2px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 14px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-align: center;
            text-decoration: none;
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
            border-color: transparent;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .action-btn i {
            font-size: 1.3rem;
        }

        /* Medicine Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-item {
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--text-dark), var(--text-medium));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-medium);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* NEW: Improved Medicine Item with Edit/Delete */
        .medicine-item {
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 16px;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            gap: 15px;
        }

        .medicine-item:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .medicine-info {
            flex: 1;
        }

        .medicine-info h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .medicine-info p {
            color: var(--text-medium);
            font-size: 0.85rem;
            margin: 0;
        }

        .medicine-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .medicine-time {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .action-icon-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
        }

        .action-icon-btn i {
            font-size: 14px;
        }

        .action-icon-btn.edit-btn {
            color: var(--info-color);
        }

        .action-icon-btn.edit-btn:hover {
            background: var(--info-color);
            color: white;
            transform: scale(1.1);
        }

        .action-icon-btn.delete-btn {
            color: var(--danger-color);
        }

        .action-icon-btn.delete-btn:hover {
            background: var(--danger-color);
            color: white;
            transform: scale(1.1);
        }

        /* Modal Styles */
        .prescription-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .prescription-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--glass-bg-medium);
            backdrop-filter: var(--glass-blur);
            border-radius: 24px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            position: relative;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .close-modal {
            background: rgba(0, 0, 0, 0.3);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-modal i {
            font-size: 1.2rem;
            color: white;
        }

        .close-modal:hover {
            background: rgba(0, 0, 0, 0.5);
            transform: rotate(90deg) scale(1.1);
        }

        /* Upload Area for Prescription Scanner */
        .upload-area {
            background: var(--glass-bg);
            border: 2px dashed var(--glass-border);
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .upload-area:hover, .upload-area.dragover {
            background: var(--glass-bg-light);
            border-color: var(--soft-lavender-blue);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--soft-lavender-blue);
            margin-bottom: 15px;
        }

        .upload-text h3 {
            font-size: 1.3rem;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .upload-text p {
            color: var(--text-medium);
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .file-input {
            display: none;
        }

        /* Scanned Results */
        .scanned-results {
            display: none;
        }

        .scanned-results.active {
            display: block;
        }

        .result-item {
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
        }

        .result-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .medicine-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .result-details {
            flex: 1;
        }

        .result-details h4 {
            font-size: 1.1rem;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .result-details p {
            color: var(--text-medium);
            font-size: 0.85rem;
        }

        .result-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .info-item {
            padding: 10px;
            background: var(--glass-bg-light);
            border-radius: 10px;
            border: 1px solid var(--glass-border-light);
        }

        .info-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-light);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .info-value {
            display: block;
            font-size: 0.9rem;
            color: var(--text-dark);
            font-weight: 500;
        }

        /* Loading Overlay for Prescription Scanner */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--glass-bg-medium);
            backdrop-filter: blur(20px);
            display: none;
            justify-content: center;
            align-items: center;
            border-radius: 24px;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        /* Improved Add Medicine Form */
        .medicine-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: var(--text-dark);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-input {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 10px;
            color: var(--text-dark);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .form-input::placeholder {
            color: var(--text-medium);
            opacity: 0.8;
            font-weight: 400;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--soft-lavender-blue);
            background: rgba(255, 255, 255, 0.35);
            box-shadow: 0 0 0 3px rgba(199, 210, 254, 0.4);
            color: var(--text-dark);
        }

        .schedule-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .schedule-btn {
            padding: 8px 12px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-dark);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .schedule-btn:hover {
            background: var(--glass-bg-light);
            transform: translateY(-2px);
        }

        .schedule-btn.selected {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
            border-color: transparent;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .selected-schedule-display {
            margin-top: 12px;
            padding: 12px;
            background: var(--glass-bg);
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            color: var(--text-dark);
            font-size: 0.9rem;
            min-height: 20px;
        }

        .form-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .form-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .form-btn.primary {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
        }

        .form-btn.secondary {
            background: var(--glass-bg);
            color: var(--text-dark);
            border: 1px solid var(--glass-border);
        }

        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .form-btn.primary:hover {
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.2);
        }

        /* Settings Modal Styles */
        .settings-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 8px;
        }

        .tab-btn {
            padding: 10px 16px;
            background: none;
            border: none;
            color: var(--text-medium);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
        }

        .tab-btn:hover {
            background: var(--glass-bg);
            color: var(--text-dark);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        .profile-form, .theme-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 8px;
        }

        .theme-option {
            padding: 16px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .theme-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .theme-option.selected {
            border-color: var(--accent-color);
            background: var(--glass-bg-light);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.1);
        }

        .theme-preview {
            width: 100%;
            height: 50px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .theme-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Alert System */
        .alert-system {
            position: fixed;
            bottom: 120px;
            right: 20px;
            z-index: 9998;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .alert {
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease;
            transform: translateX(100%);
            opacity: 0;
        }

        .alert.show {
            transform: translateX(0);
            opacity: 1;
        }

        .alert.hide {
            animation: slideOutRight 0.3s ease forwards;
        }

        .alert-icon {
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .alert-message {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .alert-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .alert-close:hover {
            opacity: 1;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Doctor Consultation Form Styles */
        .consultation-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .doctor-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .doctor-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .doctor-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-color);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .doctor-card.selected {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
        }

        .doctor-card.selected * {
            color: white !important;
        }

        .doctor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .doctor-name {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .doctor-specialty {
            color: var(--text-medium);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .doctor-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--warning-color);
            font-size: 0.85rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        textarea.form-input {
            min-height: 100px;
            resize: vertical;
            font-family: 'Inter', sans-serif;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        /* Medicine Timer Styles */
        .timer-display {
            text-align: center;
            margin: 20px 0;
        }

        .timer-countdown {
            font-size: 3rem;
            font-weight: 800;
            color: var(--text-dark);
            margin: 20px 0;
            background: linear-gradient(135deg, var(--text-dark), var(--text-medium));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .timer-info {
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--glass-border);
        }

        .timer-info h3 {
            font-size: 1.3rem;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .timer-medicine-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .timer-medicine-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--glass-bg-light);
            border-radius: 10px;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        /* Chart Container Styles */
        .chart-container {
            background: var(--glass-bg);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 20px;
            position: relative;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title i {
            color: var(--accent-color);
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .health-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            color: var(--text-medium);
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Logout Confirmation Modal */
        .logout-confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1002;
            justify-content: center;
            align-items: center;
        }

        .logout-confirmation-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .logout-modal-content {
            background: var(--glass-bg-medium);
            backdrop-filter: var(--glass-blur);
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .logout-icon {
            font-size: 4rem;
            color: var(--danger-color);
            margin-bottom: 20px;
        }

        .logout-modal-content h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .logout-modal-content p {
            color: var(--text-medium);
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .logout-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .logout-confirm-btn {
            padding: 12px 30px;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-cancel-btn {
            padding: 12px 30px;
            background: var(--glass-bg);
            color: var(--text-dark);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-confirm-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.2);
        }

        .logout-cancel-btn:hover {
            background: var(--glass-bg-light);
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .mood-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .health-metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 992px) {
            .app-header {
                padding: 12px 20px;
            }
            
            .logo h1 {
                font-size: 1.4rem;
            }
            
            .user-info {
                display: none;
            }
            
            .settings-btn, .logout-btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
            
            .main-content {
                padding: 90px 20px 120px;
            }
            
            .main-content.with-navbar {
                margin-left: 0;
            }
            
            .navbar {
                width: 250px;
                height: calc(100vh - 100px);
                top: 80px;
                left: 15px;
            }
            
            .navbar-toggle {
                top: 70px;
                left: 15px;
            }
            
            .welcome-header {
                flex-direction: column;
                text-align: center;
            }
            
            .welcome-text h2 {
                font-size: 1.8rem;
            }
            
            .welcome-text, .welcome-stats {
                min-width: 100%;
            }
            
            .chart-wrapper {
                height: 250px;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 10px;
                padding: 10px 15px;
            }
            
            .logo {
                width: 100%;
                justify-content: space-between;
            }
            
            .user-menu {
                width: 100%;
                justify-content: flex-end;
            }
            
            .welcome-section {
                padding: 20px;
            }
            
            .health-check-card {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
            
            .mood-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .result-info {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .medicine-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .medicine-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .health-metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .logout-modal-content {
                padding: 30px 20px;
            }
        }

        @media (max-width: 576px) {
            .logo h1 {
                font-size: 1.3rem;
            }
            
            .welcome-text h2 {
                font-size: 1.6rem;
            }
            
            .mood-buttons {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .theme-options {
                grid-template-columns: 1fr;
            }
            
            .form-buttons {
                flex-direction: column;
            }
            
            .header-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .settings-btn, .logout-btn {
                width: 100%;
                justify-content: center;
            }
            
            .alert-system {
                max-width: 300px;
                right: 10px;
                bottom: 110px;
            }
            
            .bottom-nav {
                width: calc(100% - 20px);
                padding: 0 10px;
                height: 65px;
            }
            
            .nav-item {
                min-width: 50px;
                padding: 8px;
            }
            
            .nav-item i {
                font-size: 20px;
            }
            
            .nav-item span {
                font-size: 10px;
            }
            
            .nav-item.add-btn {
                width: 55px;
                height: 55px;
                top: -10px;
            }
            
            .nav-item.add-btn i {
                font-size: 24px;
            }
            
            .chart-wrapper {
                height: 200px;
            }
            
            .logout-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .navbar {
                width: 90%;
                left: 5%;
                padding: 15px;
            }
            
            .nav-links a {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }

        /* ========== CHATBOT WIDGET CSS ========== */
        /* Chatbot widget custom variables */
        vapi-widget {
          --vapi-primary-color: #2563eb;
          --vapi-secondary-color: #e0f2fe;
          --vapi-bg-color: #f8fafc;
          --vapi-text-color: #1e293b;
          --vapi-bot-bubble: #e0f2fe;
          --vapi-user-bubble: #2563eb;
          --vapi-user-text: #fff;
          --vapi-header-bg: #2563eb;
          --vapi-header-text: #fff;
          --vapi-font: "Segoe UI", sans-serif;
          position: relative !important;
          display: block !important;
          width: 100% !important;
          height: 100% !important;
          margin: 0 !important;
          border-radius: 12px !important;
        }

        vapi-widget::part(bot-avatar) {
          background-image: url('https://cdn-icons-png.flaticon.com/512/3774/3774299.png');
          background-size: cover;
          border-radius: 50%;
        }

        #chatbot-container {
          position: fixed;
          bottom: 90px;
          right: 20px;
          width: 360px;
          height: 560px;
          border-radius: 16px;
          overflow: hidden;
          box-shadow: 0 8px 26px rgba(0,0,0,0.25);
          z-index: 9999;
          display: none;
          background: #fff;
          border: 2px solid #2563eb;
        }

        #chatbot-iframe {
          width: 100%;
          height: 100%;
          border: none;
        }

        #chat-fallback {
          padding: 8px;
          font-size: 13px;
          text-align: center;
          border-top: 1px solid #eee;
          background: #fafafa;
        }
    </style>

    <!-- Chatbot Configuration -->
    <script>
    window.CHATBOT_CONFIG = {
      assistantId: 'ae3149bf-85fd-4e58-898c-6ba1cd44241b',
      publicKey: '3f316145-e21e-4681-9bf0-7479538e1e33',
      projectId: 'fed07d8a-bd81-4046-8278-eced5eb7ed11'
    };
    </script>
</head>
<body>
    <!-- Alert System -->
    <div class="alert-system" id="alertSystem"></div>

    <!-- Logout Confirmation Modal -->
    <div class="logout-confirmation-modal" id="logoutConfirmationModal">
        <div class="logout-modal-content">
            <div class="logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <h2>Confirm Logout</h2>
            <p>Are you sure you want to logout from MediGear? Your session will be ended and you'll need to login again to access your health data.</p>
            <div class="logout-buttons">
                <button class="logout-confirm-btn" onclick="confirmLogout()">
                    <i class="fas fa-check"></i> Yes, Logout
                </button>
                <button class="logout-cancel-btn" onclick="cancelLogout()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Fallback Chatbot Iframe Container -->
    <div id="chatbot-container" role="dialog" aria-hidden="true">
      <iframe id="chatbot-iframe"
        src="https://readdy.ai/api/public/assistant/widget?projectId=fed07d8a-bd81-4046-8278-eced5eb7ed11"
        title="Chatbot" loading="lazy"
        allow="clipboard-read; clipboard-write; microphone; camera; autoplay">
      </iframe>
      <div id="chat-fallback">
        Chat failed to load  
        <a id="open-chat-newtab"
          href="https://readdy.ai/api/public/assistant/widget?projectId=fed07d8a-bd81-4046-8278-eced5eb7ed11"
          target="_blank" rel="noopener">open MediGearBot in a new tab</a>.
      </div>
    </div>

    <!-- Animated Background -->
    <div class="animated-background">
        <div class="bg-animation"></div>
        <div class="floating-shapes">
            <div class="floating-shape shape-1"></div>
            <div class="floating-shape shape-2"></div>
            <div class="floating-shape shape-3"></div>
            <div class="floating-shape shape-4"></div>
        </div>
        <div class="pulse-dots">
            <div class="pulse-dot dot-1"></div>
            <div class="pulse-dot dot-2"></div>
            <div class="pulse-dot dot-3"></div>
            <div class="pulse-dot dot-4"></div>
            <div class="pulse-dot dot-5"></div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-pills"></i>
            <h1>MediGear</h1>
        </div>
        <div class="loading-spinner-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading your health dashboard...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgress"></div>
            </div>
        </div>
    </div>
    
    <!-- App Header -->
    <header class="app-header">
        <div class="logo">
            <i class="fas fa-pills"></i>
            <h1>MediGear</h1>
        </div>
        <div class="user-menu">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">JD</div>
                <div>
                    <div style="font-weight: 600;" id="userName">John Doe</div>
                    <div style="font-size: 0.85rem; color: var(--text-medium);">Patient</div>
                </div>
            </div>
            <div class="header-buttons">
                <button class="settings-btn" onclick="openSettingsModal()">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="logout-btn" onclick="openLogoutConfirmation()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </header>

    <!-- NEW: Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-item active" data-page="home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" data-page="tracker">
            <i class="fas fa-calendar-check"></i>
            <span>Tracker</span>
        </div>
        <div class="nav-item add-btn" onclick="openAddMedicineModal()">
            <i class="fas fa-plus"></i>
        </div>
        <div class="nav-item" data-page="health">
            <i class="fas fa-heart-pulse"></i>
            <span>Health</span>
        </div>
        <div class="nav-item" data-page="profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </div>
    </nav>

    <!-- Navbar Toggle Button - ALWAYS VISIBLE -->
    <div class="navbar-toggle" id="navbarToggle">
        <i class="fas fa-chevron-right"></i>
    </div>

    <!-- Glassy Collapsible Navbar -->
    <nav class="navbar" id="navbar">
        <ul class="nav-links">
            <li><a href="#" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#" id="addMedicineBtn"><i class="fas fa-plus-circle"></i> Add Medicine</a></li>
            <li><a href="#" id="medicationTrackerBtn"><i class="fas fa-calendar-alt"></i> Medicine Tracker</a></li>
            <li><a href="#" id="prescriptionBtn"><i class="fas fa-file-prescription"></i> Prescription Scanner</a></li>
            <li><a href="#" id="medicineTimerBtn"><i class="fas fa-clock"></i> Medicine Timer</a></li>
            <li><a href="#" id="healthSummaryBtn"><i class="fas fa-chart-bar"></i> Health Summary</a></li>
            <li><a href="#" id="symptomCheckerBtn"><i class="fas fa-stethoscope"></i> Symptom Checker</a></li>
            <li><a href="#" id="doctorConsultationBtn"><i class="fas fa-user-md"></i> Doctor Consultation</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="dashboard-container">
            <!-- Welcome Section - FULL WIDTH -->
            <section class="welcome-section">
                <div class="welcome-header">
                    <div class="welcome-text">
                        <h2 id="welcomeMessage">Welcome back, John! </h2>
                        <p>Manage your health journey with personalized care and smart medication tracking. Stay on top of your medicines with automatic reminders and get instant access to healthcare professionals.</p>
                        <div class="quick-actions" style="margin-top: 25px;">
                            <button class="action-btn" onclick="openAddMedicineModal()">
                                <i class="fas fa-plus-circle"></i>
                                Add Medicine
                            </button>
                            <button class="action-btn" onclick="openMedicineTimerModal()">
                                <i class="fas fa-clock"></i>
                                View Timer
                            </button>
                            <button class="action-btn" onclick="openDoctorConsultationModal()">
                                <i class="fas fa-user-md"></i>
                                Book Consultation
                            </button>
                            <button class="action-btn" onclick="openHealthSummaryModal()">
                                <i class="fas fa-chart-bar"></i>
                                View Summary
                            </button>
                        </div>
                    </div>
                    <div class="welcome-stats">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="activeMeds">0</div>
                                <div class="stat-label">Active Medicines</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="adherenceRate">0%</div>
                                <div class="stat-label">Adherence Rate</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="todayReminders">0</div>
                                <div class="stat-label">Today's Reminders</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="daysStreak">0</div>
                                <div class="stat-label">Day Streak</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Health Check Card -->
                <div class="health-check-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="card-title">
                            <h3>Daily Health Check</h3>
                            <p>How are you feeling today?</p>
                        </div>
                    </div>
                    
                    <div class="mood-buttons" id="moodButtons">
                        <!-- Mood buttons will be dynamically generated -->
                    </div>
                    
                    <div class="health-tips" id="healthTips" style="display: none;">
                        <!-- Health tips will appear here -->
                    </div>
                </div>

                <!-- Medicine Overview Card -->
                <div class="health-check-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="card-title">
                            <h3>Medicine Overview</h3>
                            <p>Today's schedule and recent medicines</p>
                        </div>
                    </div>
                    
                    <div class="recent-medicines">
                        <div class="medicines-list" id="medicinesList">
                            <!-- Medicines will be dynamically generated -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- All other modals remain the same as your original code -->
    <!-- Prescription Scanner Modal -->
    <div class="prescription-modal" id="prescriptionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Prescription Scanner</h2>
                <button class="close-modal" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-file-prescription"></i>
                </div>
                <div class="upload-text">
                    <h3>Upload Prescription</h3>
                    <p>Upload an image of your prescription to automatically scan medicines, doses, and instructions</p>
                    <p style="font-size: 0.9rem; color: var(--text-medium); margin-bottom: 20px;">
                        Supported formats: JPG, PNG, PDF  Max size: 10MB
                    </p>
                    <button class="form-btn primary" id="uploadBtn">
                        <i class="fas fa-upload"></i> Choose File
                    </button>
                    <input type="file" class="file-input" id="fileInput" accept="image/*,.pdf">
                    <p style="font-size: 0.9rem; color: var(--text-medium); margin-top: 15px;">
                        Or drag and drop your file here
                    </p>
                </div>
            </div>
            
            <!-- Scanned Results Area -->
            <div class="scanned-results" id="scannedResults">
                <!-- Scanned results will appear here -->
            </div>
            
            <!-- Loading Overlay -->
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-spinner"></div>
                <div style="margin-left: 20px; text-align: center;">
                    <p style="color: var(--text-dark); font-weight: 600; margin-bottom: 5px;">Scanning Prescription...</p>
                    <p style="color: var(--text-medium); font-size: 0.9rem;">Extracting medicine information</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Improved Add Medicine Modal -->
    <div class="prescription-modal" id="addMedicineModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Medicine</h2>
                <button class="close-modal" onclick="closeAddMedicineModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="medicine-form">
                <div class="form-group">
                    <label>Medicine Name</label>
                    <input type="text" id="medicineName" class="form-input" placeholder="e.g., Metformin 500mg">
                </div>
                
                <div class="form-group">
                    <label>Dosage</label>
                    <input type="text" id="medicineDosage" class="form-input" placeholder="e.g., 1 tablet">
                </div>
                
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" id="medicineTime" class="form-input">
                </div>
                
                <div class="form-group">
                    <label>For (Condition)</label>
                    <input type="text" id="medicineFor" class="form-input" placeholder="e.g., Diabetes">
                </div>
                
                <div class="form-group">
                    <label>Schedule</label>
                    <div class="schedule-selection">
                        <button class="schedule-btn" data-day="daily">Daily</button>
                        <button class="schedule-btn" data-day="mon">Mon</button>
                        <button class="schedule-btn" data-day="tue">Tue</button>
                        <button class="schedule-btn" data-day="wed">Wed</button>
                        <button class="schedule-btn" data-day="thu">Thu</button>
                        <button class="schedule-btn" data-day="fri">Fri</button>
                        <button class="schedule-btn" data-day="sat">Sat</button>
                        <button class="schedule-btn" data-day="sun">Sun</button>
                    </div>
                    <div class="selected-schedule-display" id="selectedScheduleDisplay">Every day</div>
                </div>
                
                <div class="form-buttons">
                    <button class="form-btn primary" onclick="saveMedicine()">
                        <i class="fas fa-save"></i> Save Medicine
                    </button>
                    <button class="form-btn secondary" onclick="closeAddMedicineModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="prescription-modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-modal" onclick="closeSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="settings-tabs">
                <button class="tab-btn active" data-tab="profile">Profile</button>
                <button class="tab-btn" data-tab="theme">Theme & Appearance</button>
                <button class="tab-btn" data-tab="caregiver">Caregiver Settings</button>
            </div>
            
            <!-- Profile Tab -->
            <div class="tab-content active" id="profileTab">
                <div class="profile-form">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profileName" class="form-input" placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="profileEmail" class="form-input" placeholder="Enter your email">
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" id="profilePhone" class="form-input" placeholder="Enter your phone number">
                    </div>
                    
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="profileDob" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="profileGender" class="form-input">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    
                    <div class="form-buttons">
                        <button class="form-btn primary" onclick="saveProfile()">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button class="form-btn secondary" onclick="closeSettingsModal()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Theme Tab -->
            <div class="tab-content" id="themeTab">
                <div class="theme-form">
                    <div class="form-group">
                        <label>Background Animation</label>
                        <div style="display: flex; gap: 15px; margin-top: 10px;">
                            <button class="form-btn secondary" onclick="toggleBackgroundAnimation()" style="flex: 1;">
                                <i class="fas fa-play"></i> Toggle Animation
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Select Theme</label>
                        <div class="theme-options">
                            <div class="theme-option" data-theme="0" onclick="selectTheme(0)">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #C7D2FE, #F5D0FE);"></div>
                                <div class="theme-name">Lavender Bliss</div>
                                <div style="font-size: 0.85rem; color: var(--text-medium);">Soft lavender and pink</div>
                            </div>
                            
                            <div class="theme-option" data-theme="1" onclick="selectTheme(1)">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #A5B4FC, #E9D5FF);"></div>
                                <div class="theme-name">Ocean Breeze</div>
                                <div style="font-size: 0.85rem; color: var(--text-medium);">Cool blue and purple</div>
                            </div>
                            
                            <div class="theme-option" data-theme="2" onclick="selectTheme(2)">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #818CF8, #D8B4FE);"></div>
                                <div class="theme-name">Royal Purple</div>
                                <div style="font-size: 0.85rem; color: var(--text-medium);">Deep purple and violet</div>
                            </div>
                            
                            <div class="theme-option" data-theme="3" onclick="selectTheme(3)">
                                <div class="theme-preview" style="background: linear-gradient(135deg, #6366F1, #C084FC);"></div>
                                <div class="theme-name">Midnight Blue</div>
                                <div style="font-size: 0.85rem; color: var(--text-medium);">Indigo and magenta</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button class="form-btn secondary" onclick="closeSettingsModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Caregiver Tab -->
            <div class="tab-content" id="caregiverTab">
                <div class="profile-form">
                    <div class="form-group">
                        <label>Caregiver Name</label>
                        <input type="text" id="caregiverName" class="form-input" placeholder="Enter caregiver's name">
                    </div>
                    
                    <div class="form-group">
                        <label>Caregiver Email</label>
                        <input type="email" id="caregiverEmail" class="form-input" placeholder="Enter caregiver's email">
                    </div>
                    
                    <div class="form-group">
                        <label>Caregiver Phone</label>
                        <input type="tel" id="caregiverPhone" class="form-input" placeholder="Enter caregiver's phone number">
                    </div>
                    
                    <div class="form-group">
                        <label>Enable Caregiver Alerts</label>
                        <div style="margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="caregiverAlertsEnabled" style="width: 20px; height: 20px;">
                                <span>Send medicine reminders and alerts to caregiver</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Alert Types</label>
                        <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="alertMedicineReminder" style="width: 18px; height: 18px;" checked>
                                <span>Medicine reminder alerts</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="alertMissedDose" style="width: 18px; height: 18px;" checked>
                                <span>Missed dose alerts</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="alertEmergency" style="width: 18px; height: 18px;" checked>
                                <span>Emergency alerts</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button class="form-btn primary" onclick="saveCaregiverSettings()">
                            <i class="fas fa-save"></i> Save Caregiver Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Medicine Tracker Modal -->
    <div class="prescription-modal" id="medicineTrackerModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Medicine Tracker</h2>
                <button class="close-modal" onclick="closeMedicineTrackerModal()"><i class="fas fa-times"></i></button>
            </div>
            <div style="padding: 20px;" id="trackerView"></div>
        </div>
    </div>

    <!-- Enhanced Medicine Timer Modal -->
    <div class="prescription-modal" id="medicineTimerModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Medicine Timer & Reminder</h2>
                <button class="close-modal" onclick="closeMedicineTimerModal()"><i class="fas fa-times"></i></button>
            </div>
            <div style="padding: 30px;">
                <div class="timer-display">
                    <h3 style="color: var(--text-dark); margin-bottom: 10px;">Next Medicine</h3>
                    <div class="timer-countdown" id="timerCountdown">--:--</div>
                    <div id="nextMedicineInfo" style="color: var(--text-medium); margin-bottom: 20px;">
                        No medicines scheduled for today
                    </div>
                </div>
                
                <div class="timer-info">
                    <h3>Today's Medicine Schedule</h3>
                    <div class="timer-medicine-list" id="timerMedicineList">
                        <!-- Medicine list will be dynamically generated -->
                    </div>
                </div>
                
                <div class="timer-controls">
                    <button class="form-btn primary" id="startTimerBtn" onclick="startMedicineTimer()" disabled>
                        <i class="fas fa-play"></i> Start Timer
                    </button>
                    <button class="form-btn secondary" id="stopTimerBtn" onclick="stopMedicineTimer()" disabled>
                        <i class="fas fa-stop"></i> Stop Timer
                    </button>
                    <button class="form-btn" onclick="checkForDueMedicines()" style="background: var(--warning-color); color: white;">
                        <i class="fas fa-bell"></i> Check Now
                    </button>
                </div>
                
                <div style="margin-top: 25px; padding: 15px; background: var(--glass-bg-light); border-radius: 12px; border: 1px solid var(--glass-border);">
                    <h4 style="color: var(--text-dark); margin-bottom: 10px;"><i class="fas fa-bell" style="color: var(--warning-color);"></i> Alert System Status</h4>
                    <p style="color: var(--text-medium); font-size: 0.9rem; margin-bottom: 5px;">
                        <span id="timerStatus">Timer is not running</span>
                    </p>
                    <p style="color: var(--text-medium); font-size: 0.85rem;">
                        <i class="fas fa-info-circle" style="color: var(--info-color);"></i>
                        Alerts will be sent to you and your caregiver when medicine is due
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Health Summary Modal with Charts -->
    <div class="prescription-modal" id="healthSummaryModal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2>Health Summary & Analytics</h2>
                <button class="close-modal" onclick="closeHealthSummaryModal()"><i class="fas fa-times"></i></button>
            </div>
            <div style="padding: 20px;">
                <!-- Health Metrics Grid -->
                <div class="health-metrics-grid" id="healthMetricsGrid">
                    <!-- Metrics will be dynamically generated -->
                </div>
                
                <!-- Adherence Chart -->
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        Medication Adherence Rate
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="adherenceChart"></canvas>
                    </div>
                </div>
                
                <!-- Medicine Distribution Chart -->
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-pills"></i>
                        Medicine Schedule Distribution
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="medicineDistributionChart"></canvas>
                    </div>
                </div>
                
                <!-- Medicine List -->
                <div class="chart-container">
                    <div class="chart-title">
                        <i class="fas fa-list-check"></i>
                        Medicine Details
                    </div>
                    <div id="healthSummaryMedicines">
                        <!-- Medicine list will be dynamically generated -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Doctor Consultation Modal -->
    <div class="prescription-modal" id="doctorConsultationModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2><i class="fas fa-user-md" style="margin-right: 10px;"></i>Book Doctor Consultation</h2>
                <button class="close-modal" onclick="closeDoctorConsultationModal()"><i class="fas fa-times"></i></button>
            </div>
            <div style="padding: 30px;">
                <p style="text-align: center; color: var(--text-medium); margin-bottom: 30px; font-size: 0.95rem;">
                    Schedule a consultation with our certified doctors. Available for video call, phone call, or chat.
                </p>

                <!-- Doctor Selection -->
                <div class="doctor-cards" id="doctorSelection">
                    <!-- Doctor cards will be dynamically generated -->
                </div>

                <!-- Consultation Form -->
                <div class="consultation-form" id="consultationForm" style="display: none;">
                    <div class="form-group">
                        <label>Consultation Type</label>
                        <select id="consultationType" class="form-input">
                            <option value="video">Video Call</option>
                            <option value="phone">Phone Call</option>
                            <option value="chat">Chat</option>
                            <option value="in-person">In-Person</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Preferred Date</label>
                            <input type="date" id="consultationDate" class="form-input" min="">
                        </div>
                        <div class="form-group">
                            <label>Preferred Time</label>
                            <input type="time" id="consultationTime" class="form-input">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Health Concern / Symptoms</label>
                        <textarea id="healthConcern" class="form-input" placeholder="Describe your health concern or symptoms..." rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Any questions or special requests?</label>
                        <textarea id="specialRequests" class="form-input" placeholder="Any specific questions or requests for the doctor..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button class="form-btn primary" onclick="submitConsultationRequest()">
                            <i class="fas fa-calendar-check"></i> Book Consultation
                        </button>
                        <button class="form-btn secondary" onclick="goBackToDoctorSelection()">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                    </div>
                </div>
                
                <!-- Selected Doctor Info -->
                <div id="selectedDoctorInfo" style="display: none;">
                    <div style="background: var(--glass-bg); padding: 20px; border-radius: 12px; border: 1px solid var(--glass-border); margin-bottom: 25px;">
                        <h3 style="color: var(--text-dark); margin-bottom: 15px;">Selected Doctor</h3>
                        <div id="doctorDetails"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Symptom Checker Modal -->
    <div class="prescription-modal" id="symptomCheckerModal">
        <div class="modal-content" style="max-width: 1000px; max-height: 85vh; overflow-y: auto;">
            <div class="modal-header">
                <h2><i class="fas fa-stethoscope" style="margin-right: 10px;"></i>AI Symptom Checker</h2>
                <button class="close-modal" onclick="closeSymptomCheckerModal()"><i class="fas fa-times"></i></button>
            </div>
            <div style="padding: 30px;">
                <p style="text-align: center; color: var(--text-medium); margin-bottom: 30px; font-size: 0.95rem;">
                    Get instant preliminary diagnosis suggestions with urgency levels and remedies. <br>
                    <span style="font-size: 0.85rem; color: var(--text-light);"> Always consult with a qualified doctor for medical concerns.</span>
                </p>

                <!-- Progress Steps -->
                <div class="symptom-steps">
                    <div class="symptom-step active" id="symptomStep1">1</div>
                    <div class="symptom-bar" id="symptomBar1"></div>
                    <div class="symptom-step" id="symptomStep2">2</div>
                    <div class="symptom-bar" id="symptomBar2"></div>
                    <div class="symptom-step" id="symptomStep3">3</div>
                </div>

                <!-- Step 1: Select Symptoms -->
                <div id="symptomStep1Content">
                    <h3 style="text-align: center; margin-bottom: 25px; color: var(--text-dark);">Select Your Symptoms</h3>
                    
                    <div class="symptom-group">
                        <h4 style="color: var(--text-dark); font-weight: 600; margin-bottom: 12px;">General</h4>
                        <div class="symptoms-grid">
                            <div class="symptom-pill">Fever</div>
                            <div class="symptom-pill">Fatigue</div>
                            <div class="symptom-pill">Headache</div>
                            <div class="symptom-pill">Body ache</div>
                            <div class="symptom-pill">Weakness</div>
                            <div class="symptom-pill">Loss of appetite</div>
                        </div>
                    </div>

                    <div class="symptom-group">
                        <h4 style="color: var(--text-dark); font-weight: 600; margin-bottom: 12px;">Respiratory</h4>
                        <div class="symptoms-grid">
                            <div class="symptom-pill">Cough</div>
                            <div class="symptom-pill">Shortness of breath</div>
                            <div class="symptom-pill">Chest pain</div>
                            <div class="symptom-pill">Sore throat</div>
                            <div class="symptom-pill">Runny nose</div>
                            <div class="symptom-pill">Sneezing</div>
                        </div>
                    </div>

                    <div class="symptom-group">
                        <h4 style="color: var(--text-dark); font-weight: 600; margin-bottom: 12px;">Digestive</h4>
                        <div class="symptoms-grid">
                            <div class="symptom-pill">Nausea</div>
                            <div class="symptom-pill">Vomiting</div>
                            <div class="symptom-pill">Diarrhea</div>
                            <div class="symptom-pill">Stomach pain</div>
                            <div class="symptom-pill">Constipation</div>
                            <div class="symptom-pill">Bloating</div>
                        </div>
                    </div>

                    <div class="symptom-group">
                        <h4 style="color: var(--text-dark); font-weight: 600; margin-bottom: 12px;">Neurological</h4>
                        <div class="symptoms-grid">
                            <div class="symptom-pill">Dizziness</div>
                            <div class="symptom-pill">Confusion</div>
                            <div class="symptom-pill">Memory problems</div>
                            <div class="symptom-pill">Numbness</div>
                            <div class="symptom-pill">Tingling</div>
                            <div class="symptom-pill">Seizures</div>
                        </div>
                    </div>

                    <div class="symptom-group">
                        <h4 style="color: var(--text-dark); font-weight: 600; margin-bottom: 12px;">Cardiovascular</h4>
                        <div class="symptoms-grid">
                            <div class="symptom-pill">Chest pressure</div>
                            <div class="symptom-pill">Irregular heartbeat</div>
                            <div class="symptom-pill">Fainting</div>
                            <div class="symptom-pill">Swelling in legs</div>
                            <div class="symptom-pill">Shortness of breath on exertion</div>
                            <div class="symptom-pill">High blood pressure</div>
                        </div>
                    </div>

                    <div class="symptom-group">
                        <h4 style="color: var(--text-dark); font-weight: 600; margin-bottom: 12px;">Dermatological</h4>
                        <div class="symptoms-grid">
                            <div class="symptom-pill">Rash</div>
                            <div class="symptom-pill">Itching</div>
                            <div class="symptom-pill">Redness</div>
                            <div class="symptom-pill">Swelling</div>
                            <div class="symptom-pill">Skin dryness</div>
                            <div class="symptom-pill">Hives</div>
                        </div>
                    </div>

                    <button class="form-btn primary" id="symptomNextStep1" style="display: block; margin: 30px auto 0; width: 200px;">
                        <i class="fas fa-arrow-right"></i> Next
                    </button>
                </div>

                <!-- Step 2: Confirm Symptoms -->
                <div id="symptomStep2Content" style="display: none;">
                    <h3 style="text-align: center; margin-bottom: 25px; color: var(--text-dark);">Confirm Your Selected Symptoms</h3>
                    <div style="background: var(--glass-bg); padding: 20px; border-radius: 12px; border: 1px solid var(--glass-border); margin-bottom: 20px;">
                        <h4 style="color: var(--text-dark); margin-bottom: 15px;">Selected Symptoms:</h4>
                        <ul id="selectedSymptomsList" style="list-style: none; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;"></ul>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="form-btn secondary" id="symptomBackStep2" style="width: 150px;">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button class="form-btn primary" id="symptomNextStep2" style="width: 150px;">
                            Analyze <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Results -->
                <div id="symptomStep3Content" style="display: none;">
                    <h3 style="text-align: center; margin-bottom: 25px; color: var(--text-dark);">Preliminary Diagnosis</h3>
                    <div id="symptomResults" style="background: var(--glass-bg); padding: 25px; border-radius: 12px; border: 1px solid var(--glass-border); margin-bottom: 20px;"></div>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="form-btn primary" id="symptomRestartBtn">
                            <i class="fas fa-redo"></i> Start Over
                        </button>
                        <button class="form-btn secondary" onclick="openDoctorConsultationModal()">
                            <i class="fas fa-user-md"></i> Book Consultation
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================== GLOBAL VARIABLES ==================
      
        let timerInterval = null;
        let selectedDoctorId = null;
        let selectedSymptoms = [];
        let currentEditId = null;
        let selectedSchedule = ['daily'];
        let adherenceChart = null;
        let medicineDistributionChart = null;
        
        // Doctor data
        const doctors = [
            {
                id: 1,
                name: "Dr. Sarah Johnson",
                specialty: "General Physician",
                experience: "12 years",
                rating: 4.8,
                availability: ["Mon", "Wed", "Fri"],
                consultationFee: "$50",
                description: "Specialized in preventive care and chronic disease management."
            },
            {
                id: 2,
                name: "Dr. Michael Chen",
                specialty: "Cardiologist",
                experience: "15 years",
                rating: 4.9,
                availability: ["Tue", "Thu", "Sat"],
                consultationFee: "$80",
                description: "Expert in heart health and cardiovascular diseases."
            },
            {
                id: 3,
                name: "Dr. Emily Williams",
                specialty: "Pediatrician",
                experience: "10 years",
                rating: 4.7,
                availability: ["Mon", "Tue", "Thu", "Fri"],
                consultationFee: "$60",
                description: "Specialized in child healthcare and development."
            },
            {
                id: 4,
                name: "Dr. Robert Davis",
                specialty: "Neurologist",
                experience: "18 years",
                rating: 4.9,
                availability: ["Wed", "Fri", "Sat"],
                consultationFee: "$90",
                description: "Expert in neurological disorders and treatment."
            },
            {
                id: 5,
                name: "Dr. Lisa Martinez",
                specialty: "Dermatologist",
                experience: "8 years",
                rating: 4.6,
                availability: ["Mon", "Wed", "Sat"],
                consultationFee: "$70",
                description: "Specialized in skin conditions and cosmetic dermatology."
            },
            {
                id: 6,
                name: "Dr. James Wilson",
                specialty: "Orthopedic Surgeon",
                experience: "20 years",
                rating: 4.9,
                availability: ["Tue", "Thu"],
                consultationFee: "$100",
                description: "Expert in bone and joint health, surgeries."
            }
        ];

        // Diagnosis rules
        const diagnosisRules = {
            "Flu": {
                symptoms: ["Fever", "Cough", "Fatigue", "Body ache", "Headache"],
                remedies: ["Rest well", "Stay hydrated", "Take paracetamol if needed", "Drink warm fluids"],
                urgency: "Moderate"
            },
            "Common Cold": {
                symptoms: ["Runny nose", "Sneezing", "Sore throat", "Cough"],
                remedies: ["Drink warm fluids", "Rest", "Steam inhalation", "Use saline nasal drops"],
                urgency: "Mild"
            },
            "COVID-19": {
                symptoms: ["Fever", "Cough", "Shortness of breath", "Loss of appetite", "Fatigue"],
                remedies: ["Isolate yourself", "Stay hydrated", "Monitor oxygen levels", "Seek medical attention if symptoms worsen"],
                urgency: "Severe"
            },
            "Migraine": {
                symptoms: ["Headache", "Nausea", "Vomiting"],
                remedies: ["Rest in a quiet dark room", "Stay hydrated", "Apply cold/warm compress"],
                urgency: "Moderate"
            },
            "Food Poisoning": {
                symptoms: ["Nausea", "Vomiting", "Diarrhea", "Stomach pain"],
                remedies: ["Drink oral rehydration solution", "Avoid solid food", "Rest", "Seek medical help if severe"],
                urgency: "Moderate"
            },
            "Stroke": {
                symptoms: ["Confusion", "Dizziness", "Numbness", "Tingling", "Seizures"],
                remedies: ["Call emergency services immediately", "Do not give food/drink", "Keep the person calm"],
                urgency: "Emergency"
            },
            "Gastroenteritis": {
                symptoms: ["Diarrhea", "Vomiting", "Stomach pain", "Nausea"],
                remedies: ["Rest and hydrate", "Avoid dairy and fatty foods", "Seek medical attention if symptoms persist"],
                urgency: "Moderate"
            },
            "Heart Attack": {
                symptoms: ["Chest pain", "Chest pressure", "Shortness of breath", "Fainting"],
                remedies: ["Call emergency immediately", "Chew aspirin if available", "Stay calm"],
                urgency: "Emergency"
            },
            "Hypertension": {
                symptoms: ["High blood pressure", "Headache", "Fatigue"],
                remedies: ["Monitor blood pressure regularly", "Limit salt intake", "Consult a doctor"],
                urgency: "Moderate"
            },
            "Allergic Reaction": {
                symptoms: ["Rash", "Itching", "Hives", "Swelling"],
                remedies: ["Take antihistamines", "Avoid allergen", "Apply hydrocortisone cream"],
                urgency: "Moderate"
            }
        };

        // Mood data
        const moodData = [
            {
                mood: "Excellent",
                emoji: "",
                color: "#10B981",
                tips: [
                    "Maintain your healthy routines and stay consistent.",
                    "Consider light exercise to maintain energy.",
                    "Stay hydrated with water throughout the day."
                ]
            },
            {
                mood: "Good",
                emoji: "",
                color: "#3B82F6",
                tips: [
                    "Keep up with your medication schedule.",
                    "Take short breaks to stretch regularly.",
                    "Practice mindfulness for mental well-being."
                ]
            },
            {
                mood: "Okay",
                emoji: "",
                color: "#F59E0B",
                tips: [
                    "Listen to calming music for relaxation.",
                    "Drink herbal tea for comfort.",
                    "Take a short walk if possible."
                ]
            },
            {
                mood: "Tired",
                emoji: "",
                color: "#8B5CF6",
                tips: [
                    "Consider a short power nap if possible.",
                    "Reduce caffeine in the afternoon.",
                    "Practice relaxation techniques before bed."
                ]
            },
            {
                mood: "Stressed",
                emoji: "",
                color: "#F97316",
                tips: [
                    "Try 4-7-8 breathing technique.",
                    "Take 5-minute breaks from stressors.",
                    "Stay consistent with medication schedule."
                ]
            },
            {
                mood: "Unwell",
                emoji: "",
                color: "#EF4444",
                tips: [
                    "Rest and prioritize sleep for recovery.",
                    "Stay hydrated with water or clear fluids.",
                    "Contact healthcare provider if needed."
                ]
            }
        ];

        // ================== LOGOUT FUNCTIONS ==================
        function openLogoutConfirmation() {
            const modal = document.getElementById('logoutConfirmationModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLogoutConfirmation() {
            const modal = document.getElementById('logoutConfirmationModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function confirmLogout() {
            medicineTimer.stopTimer();
            localStorage.removeItem('medigear_logged_in');
            localStorage.removeItem('medigear_username');
            
            // Close confirmation modal
            closeLogoutConfirmation();
            
            // Redirect to login page
            window.location.href = 'login.html';
        }

        function cancelLogout() {
            closeLogoutConfirmation();
        }

        // ================== ENHANCED HEALTH SUMMARY FUNCTIONS ==================
        function loadHealthSummaryData() {
            const medicines = getMedicines();
            const tracker = JSON.parse(localStorage.getItem('medigear_tracker') || '{}');
            
            const totalMedicines = medicines.length;
            const takenMedicines = Object.values(tracker).filter(v => v === true).length;
            const adherenceRate = totalMedicines > 0 ? Math.round((takenMedicines / totalMedicines) * 100) : 0;
            const dayStreak = localStorage.getItem('medigear_day_streak') || '0';
            
            // Update metrics grid
            const metricsGrid = document.getElementById('healthMetricsGrid');
            metricsGrid.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${totalMedicines}</div>
                    <div class="metric-label">Total Medicines</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${adherenceRate}%</div>
                    <div class="metric-label">Adherence Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${dayStreak}</div>
                    <div class="metric-label">Day Streak</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${getTodayMedicinesCount()}</div>
                    <div class="metric-label">Today's Medicines</div>
                </div>
            `;
            
            // Create charts
            createAdherenceChart(adherenceRate);
            createMedicineDistributionChart(medicines);
            
            // Update medicine list
            updateHealthSummaryMedicineList(medicines, tracker);
        }

        function getTodayMedicinesCount() {
            const medicines = getMedicines();
            const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
            
            return medicines.filter(medicine => {
                const schedule = medicine.schedule || ['daily'];
                return schedule.includes('daily') || schedule.includes(today);
            }).length;
        }

        function createAdherenceChart(adherenceRate) {
            const ctx = document.getElementById('adherenceChart').getContext('2d');
            
            // Destroy previous chart if exists
            if (adherenceChart) {
                adherenceChart.destroy();
            }
            
            adherenceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Adherence', 'Missed'],
                    datasets: [{
                        data: [adherenceRate, 100 - adherenceRate],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(239, 68, 68, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'var(--text-dark)',
                                font: {
                                    family: "'Inter', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function createMedicineDistributionChart(medicines) {
            const ctx = document.getElementById('medicineDistributionChart').getContext('2d');
            
            // Count medicines by time of day
            const timeCategories = {
                'Morning': 0,
                'Afternoon': 0,
                'Evening': 0,
                'Night': 0
            };
            
            medicines.forEach(medicine => {
                if (medicine.time) {
                    const hour = parseInt(medicine.time.split(':')[0]);
                    if (hour >= 5 && hour < 12) timeCategories.Morning++;
                    else if (hour >= 12 && hour < 17) timeCategories.Afternoon++;
                    else if (hour >= 17 && hour < 22) timeCategories.Evening++;
                    else timeCategories.Night++;
                }
            });
            
            // Destroy previous chart if exists
            if (medicineDistributionChart) {
                medicineDistributionChart.destroy();
            }
            
            medicineDistributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(timeCategories),
                    datasets: [{
                        label: 'Number of Medicines',
                        data: Object.values(timeCategories),
                        backgroundColor: [
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(192, 132, 252, 0.8)'
                        ],
                        borderColor: [
                            'rgba(99, 102, 241, 1)',
                            'rgba(139, 92, 246, 1)',
                            'rgba(168, 85, 247, 1)',
                            'rgba(192, 132, 252, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'var(--text-medium)',
                                font: {
                                    family: "'Inter', sans-serif"
                                },
                                stepSize: 1
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'var(--text-dark)',
                                font: {
                                    family: "'Inter', sans-serif"
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateHealthSummaryMedicineList(medicines, tracker) {
            const container = document.getElementById('healthSummaryMedicines');
            
            if (medicines.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--text-medium);">
                        <i class="fas fa-pills" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>No medicines added yet</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--glass-bg-light); border-bottom: 2px solid var(--glass-border);">
                                <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Medicine</th>
                                <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Dosage</th>
                                <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Time</th>
                                <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            medicines.forEach(medicine => {
                const isTaken = tracker[`medicine_${medicine.id}`] === true;
                const status = isTaken ? 'Taken' : 'Pending';
                const statusColor = isTaken ? 'var(--success-color)' : 'var(--warning-color)';
                const statusIcon = isTaken ? 'fa-check-circle' : 'fa-clock';
                
                html += `
                    <tr style="border-bottom: 1px solid var(--glass-border-light);">
                        <td style="padding: 12px 15px;">
                            <div style="font-weight: 600; color: var(--text-dark);">${medicine.name}</div>
                            <div style="font-size: 0.85rem; color: var(--text-medium);">${medicine.for || 'General'}</div>
                        </td>
                        <td style="padding: 12px 15px; color: var(--text-dark); font-weight: 500;">${medicine.dosage}</td>
                        <td style="padding: 12px 15px;">
                            <div style="display: inline-block; background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink)); color: white; padding: 5px 12px; border-radius: 20px; font-weight: 600; font-size: 0.85rem;">
                                ${medicine.time || 'Not set'}
                            </div>
                        </td>
                        <td style="padding: 12px 15px;">
                            <div style="display: flex; align-items: center; gap: 8px; color: ${statusColor}; font-weight: 600;">
                                <i class="fas ${statusIcon}"></i>
                                ${status}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ================== ALERT SYSTEM ==================
        class AlertSystem {
            constructor() {
                this.alertSystem = document.getElementById('alertSystem');
            }

            showAlert(type, title, message, duration = 5000) {
                const alertId = 'alert-' + Date.now();
                const alertTypes = {
                    'success': { icon: 'fas fa-check-circle', color: '#10B981' },
                    'warning': { icon: 'fas fa-exclamation-triangle', color: '#F59E0B' },
                    'error': { icon: 'fas fa-times-circle', color: '#EF4444' },
                    'info': { icon: 'fas fa-info-circle', color: '#3B82F6' },
                    'reminder': { icon: 'fas fa-bell', color: '#6366F1' }
                };

                const alertType = alertTypes[type] || alertTypes.info;
                
                const alert = document.createElement('div');
                alert.className = 'alert';
                alert.id = alertId;
                alert.innerHTML = `
                    <div class="alert-icon">
                        <i class="${alertType.icon}"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">${title}</div>
                        <div class="alert-message">${message}</div>
                    </div>
                    <button class="alert-close" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                this.alertSystem.appendChild(alert);
                
                // Animate in
                setTimeout(() => {
                    alert.classList.add('show');
                }, 10);
                
                // Auto remove after duration
                if (duration > 0) {
                    setTimeout(() => {
                        this.removeAlert(alertId);
                    }, duration);
                }
                
                return alertId;
            }

            removeAlert(alertId) {
                const alert = document.getElementById(alertId);
                if (alert) {
                    alert.classList.add('hide');
                    setTimeout(() => {
                        if (alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 300);
                }
            }

            showMedicineReminder(medicine) {
                const title = ' Medicine Reminder';
                const message = `Time to take ${medicine.name} - ${medicine.dosage}`;
                this.showAlert('reminder', title, message, 10000);
                
                // Also send to caregiver if enabled
                this.sendCaregiverAlert(medicine);
            }

            sendCaregiverAlert(medicine) {
                const caregiverSettings = JSON.parse(localStorage.getItem('medigear_caregiver') || '{}');
                if (caregiverSettings.enabled && caregiverSettings.alertMedicineReminder) {
                    const message = `ALERT: ${localStorage.getItem('medigear_username') || 'Patient'} needs to take ${medicine.name} - ${medicine.dosage} at ${medicine.time}`;
                    
                    // In a real app, this would send an email/SMS
                    // For demo, we'll just log it
                    console.log('Sending alert to caregiver:', {
                        name: caregiverSettings.name,
                        email: caregiverSettings.email,
                        phone: caregiverSettings.phone,
                        message: message
                    });
                }
            }

            showMissedDoseAlert(medicine) {
                const title = ' Missed Dose Alert';
                const message = `You missed ${medicine.name} at ${medicine.time}. Please take it as soon as possible.`;
                this.showAlert('warning', title, message, 15000);
                
                // Send to caregiver
                const caregiverSettings = JSON.parse(localStorage.getItem('medigear_caregiver') || '{}');
                if (caregiverSettings.enabled && caregiverSettings.alertMissedDose) {
                    const caregiverMessage = `URGENT: ${localStorage.getItem('medigear_username') || 'Patient'} missed dose of ${medicine.name} at ${medicine.time}`;
                    console.log('Sending missed dose alert to caregiver:', caregiverMessage);
                }
            }
        }

        // Initialize alert system
        const alertSystem = new AlertSystem();

        // ================== MEDICINE TIMER SYSTEM ==================
        class MedicineTimer {
            constructor() {
                this.timerRunning = false;
                this.nextMedicine = null;
                this.nextMedicineTime = null;
                this.countdownInterval = null;
            }

            startTimer() {
                if (this.timerRunning) return;
                
                this.timerRunning = true;
                this.updateNextMedicine();
                this.startCountdown();
                this.scheduleChecks();
                
                alertSystem.showAlert('success', 'Timer Started', 'Medicine timer is now active. You will receive reminders for your medicines.', 3000);
                document.getElementById('timerStatus').textContent = 'Timer is running - Monitoring medicines';
                document.getElementById('startTimerBtn').disabled = true;
                document.getElementById('stopTimerBtn').disabled = false;
            }

            stopTimer() {
                this.timerRunning = false;
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                    this.countdownInterval = null;
                }
                
                // Clear any scheduled checks
                if (window.scheduledChecks) {
                    window.scheduledChecks.forEach(id => clearTimeout(id));
                    window.scheduledChecks = [];
                }
                
                alertSystem.showAlert('info', 'Timer Stopped', 'Medicine timer has been stopped.', 3000);
                document.getElementById('timerStatus').textContent = 'Timer is not running';
                document.getElementById('startTimerBtn').disabled = false;
                document.getElementById('stopTimerBtn').disabled = true;
            }

            updateNextMedicine() {
                const medicines = getMedicines();
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                
                let nextMed = null;
                let nextTime = Infinity;
                
                medicines.forEach(medicine => {
                    if (!medicine.time) return;
                    
                    const [hours, minutes] = medicine.time.split(':').map(Number);
                    const medicineTime = hours * 60 + minutes;
                    
                    // Check if medicine is scheduled for today
                    const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
                    const schedule = medicine.schedule || ['daily'];
                    
                    if (schedule.includes('daily') || schedule.includes(today)) {
                        // Check if medicine time is in the future today
                        if (medicineTime > currentTime && medicineTime < nextTime) {
                            nextTime = medicineTime;
                            nextMed = medicine;
                        }
                    }
                });
                
                this.nextMedicine = nextMed;
                this.nextMedicineTime = nextTime;
                
                this.updateTimerDisplay();
                this.updateMedicineList();
            }

            updateTimerDisplay() {
                const countdownEl = document.getElementById('timerCountdown');
                const infoEl = document.getElementById('nextMedicineInfo');
                
                if (!this.nextMedicine) {
                    countdownEl.textContent = '--:--';
                    infoEl.textContent = 'No medicines scheduled for today';
                    infoEl.style.color = 'var(--text-medium)';
                    return;
                }
                
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                const timeRemaining = this.nextMedicineTime - currentTime;
                
                if (timeRemaining <= 0) {
                    countdownEl.textContent = 'NOW!';
                    countdownEl.style.color = 'var(--danger-color)';
                    infoEl.innerHTML = `<strong>${this.nextMedicine.name}</strong> - ${this.nextMedicine.dosage} is due now!`;
                    infoEl.style.color = 'var(--danger-color)';
                    
                    // Trigger alert for due medicine
                    if (this.timerRunning) {
                        this.triggerMedicineAlert();
                    }
                } else {
                    const hours = Math.floor(timeRemaining / 60);
                    const minutes = timeRemaining % 60;
                    countdownEl.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                    countdownEl.style.color = '';
                    infoEl.innerHTML = `Next: <strong>${this.nextMedicine.name}</strong> at ${this.nextMedicine.time}`;
                    infoEl.style.color = 'var(--text-medium)';
                }
            }

            startCountdown() {
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                }
                
                this.countdownInterval = setInterval(() => {
                    this.updateTimerDisplay();
                }, 1000);
            }

            scheduleChecks() {
                // Clear existing checks
                if (window.scheduledChecks) {
                    window.scheduledChecks.forEach(id => clearTimeout(id));
                }
                window.scheduledChecks = [];
                
                const medicines = getMedicines();
                const now = new Date();
                
                medicines.forEach(medicine => {
                    if (!medicine.time) return;
                    
                    const [hours, minutes] = medicine.time.split(':').map(Number);
                    const medicineDateTime = new Date(now);
                    medicineDateTime.setHours(hours, minutes, 0, 0);
                    
                    // Schedule check 5 minutes before medicine time
                    const checkTime = new Date(medicineDateTime.getTime() - 5 * 60000);
                    
                    if (checkTime > now) {
                        const timeoutId = setTimeout(() => {
                            this.checkMedicineDue(medicine);
                        }, checkTime - now);
                        
                        window.scheduledChecks.push(timeoutId);
                    }
                });
            }

            checkMedicineDue(medicine) {
                if (!this.timerRunning) return;
                
                // Check if medicine is scheduled for today
                const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
                const schedule = medicine.schedule || ['daily'];
                
                if (schedule.includes('daily') || schedule.includes(today)) {
                    alertSystem.showMedicineReminder(medicine);
                }
            }

            triggerMedicineAlert() {
                if (this.nextMedicine) {
                    alertSystem.showMedicineReminder(this.nextMedicine);
                    
                    // Check for missed doses every 30 minutes
                    setTimeout(() => {
                        this.checkMissedDoses();
                    }, 30 * 60000);
                }
            }

            checkMissedDoses() {
                const medicines = getMedicines();
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();
                
                medicines.forEach(medicine => {
                    if (!medicine.time) return;
                    
                    const [hours, minutes] = medicine.time.split(':').map(Number);
                    const medicineTime = hours * 60 + minutes;
                    
                    // If medicine was due more than 30 minutes ago and not taken
                    if (medicineTime < currentTime - 30) {
                        const tracker = JSON.parse(localStorage.getItem('medigear_tracker') || '{}');
                        const medicineKey = `medicine_${medicine.id}`;
                        
                        if (!tracker[medicineKey]) {
                            alertSystem.showMissedDoseAlert(medicine);
                        }
                    }
                });
            }

            updateMedicineList() {
                const listEl = document.getElementById('timerMedicineList');
                const medicines = getMedicines();
                const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
                
                const todayMedicines = medicines.filter(medicine => {
                    if (!medicine.time) return false;
                    const schedule = medicine.schedule || ['daily'];
                    return schedule.includes('daily') || schedule.includes(today);
                }).sort((a, b) => {
                    const timeA = a.time ? a.time.replace(':', '') : '0000';
                    const timeB = b.time ? b.time.replace(':', '') : '0000';
                    return parseInt(timeA) - parseInt(timeB);
                });
                
                if (todayMedicines.length === 0) {
                    listEl.innerHTML = '<div style="text-align: center; color: var(--text-light); padding: 20px;">No medicines scheduled for today</div>';
                    return;
                }
                
                let html = '';
                todayMedicines.forEach(medicine => {
                    const tracker = JSON.parse(localStorage.getItem('medigear_tracker') || '{}');
                    const medicineKey = `medicine_${medicine.id}`;
                    const isTaken = tracker[medicineKey];
                    const status = isTaken ? ' Taken' : ' Pending';
                    const statusColor = isTaken ? 'var(--success-color)' : 'var(--warning-color)';
                    
                    html += `
                        <div class="timer-medicine-item">
                            <div>
                                <strong>${medicine.name}</strong><br>
                                <small>${medicine.dosage}  ${medicine.time}</small>
                            </div>
                            <div style="color: ${statusColor}; font-weight: 600;">${status}</div>
                        </div>
                    `;
                });
                
                listEl.innerHTML = html;
            }
        }

        // Initialize medicine timer
        const medicineTimer = new MedicineTimer();

        // ================== DOCTOR CONSULTATION FUNCTIONS ==================
        function openDoctorConsultationModal() {
            const modal = document.getElementById('doctorConsultationModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('consultationDate').min = today;
            document.getElementById('consultationDate').value = today;
            
            // Set default time to next hour
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            const timeString = nextHour.getHours().toString().padStart(2, '0') + ':00';
            document.getElementById('consultationTime').value = timeString;
            
            loadDoctorSelection();
        }

        function closeDoctorConsultationModal() {
            const modal = document.getElementById('doctorConsultationModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            resetDoctorConsultationForm();
        }

        function loadDoctorSelection() {
            const container = document.getElementById('doctorSelection');
            const consultationForm = document.getElementById('consultationForm');
            const selectedDoctorInfo = document.getElementById('selectedDoctorInfo');
            const doctorDetails = document.getElementById('doctorDetails');
            
            // Reset to selection view
            consultationForm.style.display = 'none';
            selectedDoctorInfo.style.display = 'none';
            
            let html = '';
            doctors.forEach(doctor => {
                html += `
                    <div class="doctor-card" data-doctor-id="${doctor.id}">
                        <div class="doctor-avatar">${doctor.name.charAt(0)}</div>
                        <div class="doctor-name">${doctor.name}</div>
                        <div class="doctor-specialty">${doctor.specialty}</div>
                        <div class="doctor-rating">
                            <i class="fas fa-star"></i> ${doctor.rating}
                            <span style="color: var(--text-light); margin-left: 10px;">${doctor.experience} experience</span>
                        </div>
                        <div style="margin-top: 10px; color: var(--text-medium); font-size: 0.85rem;">
                            <i class="fas fa-calendar-alt"></i> Available: ${doctor.availability.join(', ')}
                        </div>
                        <div style="margin-top: 5px; color: var(--success-color); font-weight: 600;">
                            <i class="fas fa-money-bill-wave"></i> ${doctor.consultationFee}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Add click event listeners
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.addEventListener('click', function() {
                    const doctorId = parseInt(this.getAttribute('data-doctor-id'));
                    selectDoctor(doctorId);
                });
            });
        }

        function selectDoctor(doctorId) {
            selectedDoctorId = doctorId;
            const doctor = doctors.find(d => d.id === doctorId);
            
            if (!doctor) return;
            
            // Update UI to show selected doctor
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.classList.remove('selected');
                if (parseInt(card.getAttribute('data-doctor-id')) === doctorId) {
                    card.classList.add('selected');
                }
            });
            
            // Show doctor details
            const doctorDetails = document.getElementById('doctorDetails');
            doctorDetails.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <div class="doctor-avatar" style="width: 50px; height: 50px; font-size: 1.2rem;">${doctor.name.charAt(0)}</div>
                    <div>
                        <div class="doctor-name">${doctor.name}</div>
                        <div class="doctor-specialty">${doctor.specialty}</div>
                    </div>
                </div>
                <div style="color: var(--text-medium); margin-bottom: 10px;">
                    <i class="fas fa-graduation-cap"></i> ${doctor.experience} experience
                </div>
                <div style="color: var(--text-medium); margin-bottom: 10px;">
                    <i class="fas fa-star" style="color: var(--warning-color);"></i> Rating: ${doctor.rating}/5.0
                </div>
                <div style="color: var(--text-medium); margin-bottom: 10px;">
                    <i class="fas fa-calendar-alt"></i> Available: ${doctor.availability.join(', ')}
                </div>
                <div style="color: var(--text-medium); margin-bottom: 15px;">
                    <i class="fas fa-info-circle"></i> ${doctor.description}
                </div>
                <div style="color: var(--success-color); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-money-bill-wave"></i> Consultation Fee: ${doctor.consultationFee}
                </div>
            `;
            
            // Show form
            document.getElementById('consultationForm').style.display = 'block';
            document.getElementById('selectedDoctorInfo').style.display = 'block';
        }

        function goBackToDoctorSelection() {
            document.getElementById('consultationForm').style.display = 'none';
            document.getElementById('selectedDoctorInfo').style.display = 'none';
            document.querySelectorAll('.doctor-card').forEach(card => {
                card.classList.remove('selected');
            });
            selectedDoctorId = null;
        }

        function resetDoctorConsultationForm() {
            document.getElementById('consultationType').value = 'video';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('consultationDate').value = today;
            
            const nextHour = new Date();
            nextHour.setHours(nextHour.getHours() + 1);
            const timeString = nextHour.getHours().toString().padStart(2, '0') + ':00';
            document.getElementById('consultationTime').value = timeString;
            
            document.getElementById('healthConcern').value = '';
            document.getElementById('specialRequests').value = '';
            
            goBackToDoctorSelection();
        }

        function submitConsultationRequest() {
            if (!selectedDoctorId) {
                alert('Please select a doctor first');
                return;
            }
            
            const doctor = doctors.find(d => d.id === selectedDoctorId);
            const consultationType = document.getElementById('consultationType').value;
            const date = document.getElementById('consultationDate').value;
            const time = document.getElementById('consultationTime').value;
            const concern = document.getElementById('healthConcern').value.trim();
            
            if (!concern) {
                alert('Please describe your health concern');
                return;
            }
            
            const specialRequests = document.getElementById('specialRequests').value.trim();
            
            // In a real app, this would send data to a backend
            // For demo, we'll just show a success message
            
            const consultationData = {
                doctor: doctor.name,
                specialty: doctor.specialty,
                consultationType: consultationType,
                date: date,
                time: time,
                concern: concern,
                specialRequests: specialRequests,
                fee: doctor.consultationFee,
                timestamp: new Date().toISOString()
            };
            
            // Save to localStorage for demo
            let consultations = JSON.parse(localStorage.getItem('medigear_consultations') || '[]');
            consultations.push(consultationData);
            localStorage.setItem('medigear_consultations', JSON.stringify(consultations));
            
            // Show success message
            alertSystem.showAlert('success', 'Consultation Booked!', 
                `Your consultation with ${doctor.name} has been scheduled for ${date} at ${time}. You will receive a confirmation email shortly.`, 
                10000);
            
            // Reset form and close modal
            resetDoctorConsultationForm();
            closeDoctorConsultationModal();
            
            // In a real app, you might want to send an email/SMS to the patient and doctor
            console.log('Consultation booked:', consultationData);
        }

        // ================== OTHER FUNCTIONS ==================
        // Loading Screen
        function showLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            const progressBar = document.getElementById('loadingProgress');
            
            loadingScreen.classList.remove('hidden');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        initializeDashboard();
                    }, 300);
                }
            }, 200);
        }

        // Authentication check
        function checkAuthentication() {
            const isLoggedIn = localStorage.getItem('medigear_logged_in') === 'true';
            const username = localStorage.getItem('medigear_username');
            
            if (!isLoggedIn) {
                alert('Please login to access the dashboard');
                window.location.href = 'login.html';
                return false;
            }
            
            // Update welcome message with username
            if (document.querySelector('#welcomeMessage')) {
                document.querySelector('#welcomeMessage').textContent = `Welcome back, ${username}! `;
            }
            
            // Update user info
            if (document.querySelector('#userAvatar')) {
                document.querySelector('#userAvatar').textContent = username.charAt(0).toUpperCase();
            }
            
            if (document.querySelector('#userName')) {
                document.querySelector('#userName').textContent = username;
            }
            
            return true;
        }

        // Background Animation Functions
        let animationEnabled = true;
        let currentTheme = localStorage.getItem('medigear_theme') ? parseInt(localStorage.getItem('medigear_theme')) : 0;
        const themes = [
            { primary: '#C7D2FE', secondary: '#F5D0FE', tertiary: '#DFF6FF' },
            { primary: '#A5B4FC', secondary: '#E9D5FF', tertiary: '#BAE6FD' },
            { primary: '#818CF8', secondary: '#D8B4FE', tertiary: '#7DD3FC' },
            { primary: '#6366F1', secondary: '#C084FC', tertiary: '#38BDF8' }
        ];

        function toggleBackgroundAnimation() {
            animationEnabled = !animationEnabled;
            const shapes = document.querySelectorAll('.floating-shape');
            const dots = document.querySelectorAll('.pulse-dot');
            
            if (animationEnabled) {
                shapes.forEach(shape => {
                    shape.style.animationPlayState = 'running';
                });
                dots.forEach(dot => {
                    dot.style.animationPlayState = 'running';
                });
                alert('Background animation enabled!');
            } else {
                shapes.forEach(shape => {
                    shape.style.animationPlayState = 'paused';
                });
                dots.forEach(dot => {
                    dot.style.animationPlayState = 'paused';
                });
                alert('Background animation paused!');
            }
        }

        function selectTheme(themeIndex) {
            currentTheme = themeIndex;
            const theme = themes[themeIndex];
            
            // Update CSS variables
            document.documentElement.style.setProperty('--soft-lavender-blue', theme.primary);
            document.documentElement.style.setProperty('--blush-pink', theme.secondary);
            document.documentElement.style.setProperty('--misty-sky-blue', theme.tertiary);
            
            // Update floating shapes
            document.querySelector('.shape-1').style.background = 
                `radial-gradient(circle, ${theme.primary}20 0%, ${theme.primary}00 70%)`;
            document.querySelector('.shape-2').style.background = 
                `radial-gradient(circle, ${theme.secondary}15 0%, ${theme.secondary}00 70%)`;
            document.querySelector('.shape-3').style.background = 
                `radial-gradient(circle, ${theme.tertiary}10 0%, ${theme.tertiary}00 70%)`;
            
            // Update theme selection
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.theme-option[data-theme="${themeIndex}"]`).classList.add('selected');
            
            // Save to localStorage
            localStorage.setItem('medigear_theme', themeIndex.toString());
            
            alert('Theme changed successfully!');
        }

        // NEW: Medicine Management with Edit/Delete
        function getMedicines() {
            return JSON.parse(localStorage.getItem('medigear_medicines') || '[]');
        }

        function saveMedicines(medicines) {
            localStorage.setItem('medigear_medicines', JSON.stringify(medicines));
            updateMedicineList();
            updateDashboardStats();
            
            // Update timer if running
            if (medicineTimer.timerRunning) {
                medicineTimer.updateNextMedicine();
                medicineTimer.scheduleChecks();
            }
        }

        function updateMedicineList() {
            const medicinesList = document.getElementById('medicinesList');
            const medicines = getMedicines();
            
            if (medicines.length === 0) {
                medicinesList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-medium);">
                        <i class="fas fa-pills" style="font-size: 2rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>No medicines added yet</p>
                        <p style="font-size: 0.9rem; margin-top: 10px;">Tap the + button to add</p>
                    </div>
                `;
                return;
            }
            
            medicinesList.innerHTML = medicines.map(medicine => `
                <div class="medicine-item">
                    <div class="medicine-info">
                        <h4>${medicine.name}</h4>
                        <p>${medicine.dosage}  ${medicine.for}</p>
                    </div>
                    <div class="medicine-actions">
                        <div class="medicine-time">${medicine.time}</div>
                        <button class="action-icon-btn edit-btn" onclick="editMedicine(${medicine.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-icon-btn delete-btn" onclick="deleteMedicine(${medicine.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateDashboardStats() {
            const medicines = getMedicines();
            document.getElementById('activeMeds').textContent = medicines.length;
            document.getElementById('adherenceRate').textContent = medicines.length > 0 ? '85%' : '0%';
            document.getElementById('todayReminders').textContent = medicines.length;
            document.getElementById('daysStreak').textContent = '7';
        }

        // NEW: Edit/Delete Medicine Functions
        function editMedicine(id) {
            const medicines = getMedicines();
            const medicine = medicines.find(m => m.id === id);
            
            if (!medicine) return;
            
            currentEditId = id;
            document.getElementById('modalTitle').textContent = 'Edit Medicine';
            document.getElementById('medicineName').value = medicine.name;
            document.getElementById('medicineDosage').value = medicine.dosage;
            document.getElementById('medicineTime').value = medicine.time;
            document.getElementById('medicineFor').value = medicine.for;
            
            // Set schedule
            selectedSchedule = medicine.schedule || ['daily'];
            updateScheduleDisplay();
            
            // Update schedule buttons
            document.querySelectorAll('.schedule-btn').forEach(btn => {
                const day = btn.getAttribute('data-day');
                if (day === 'daily') {
                    btn.classList.toggle('selected', selectedSchedule.includes('daily'));
                } else {
                    btn.classList.toggle('selected', selectedSchedule.includes(day));
                }
            });
            
            document.getElementById('addMedicineModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function deleteMedicine(id) {
            if (!confirm('Are you sure you want to delete this medicine?')) return;
            
            const medicines = getMedicines();
            const filtered = medicines.filter(m => m.id !== id);
            saveMedicines(filtered);
            alertSystem.showAlert('success', 'Medicine deleted successfully');
        }

        // Modal Functions
        function openAddMedicineModal() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add Medicine';
            document.getElementById('medicineName').value = '';
            document.getElementById('medicineDosage').value = '';
            document.getElementById('medicineTime').value = '';
            document.getElementById('medicineFor').value = '';
            selectedSchedule = ['daily'];
            updateScheduleDisplay();
            
            // Set current time as default
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('medicineTime').value = `${hours}:${minutes}`;
            
            // Update schedule buttons
            document.querySelectorAll('.schedule-btn').forEach(btn => {
                const day = btn.getAttribute('data-day');
                btn.classList.toggle('selected', day === 'daily');
            });
            
            document.getElementById('addMedicineModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeAddMedicineModal() {
            document.getElementById('addMedicineModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            currentEditId = null;
        }

        function updateScheduleDisplay() {
            const display = document.getElementById('selectedScheduleDisplay');
            if (selectedSchedule.includes('daily')) {
                display.textContent = 'Every day';
                display.style.color = 'var(--success-color)';
            } else {
                const dayNames = {
                    'mon': 'Monday',
                    'tue': 'Tuesday',
                    'wed': 'Wednesday',
                    'thu': 'Thursday',
                    'fri': 'Friday',
                    'sat': 'Saturday',
                    'sun': 'Sunday'
                };
                const selectedDays = selectedSchedule.map(day => dayNames[day]).join(', ');
                display.textContent = selectedDays;
                display.style.color = 'var(--info-color)';
            }
        }

        function saveMedicine() {
            const name = document.getElementById('medicineName').value.trim();
            const dosage = document.getElementById('medicineDosage').value.trim();
            const time = document.getElementById('medicineTime').value;
            const forCondition = document.getElementById('medicineFor').value.trim();
            
            if (!name || !dosage || !time) {
                alertSystem.showAlert('error', 'Please fill all required fields');
                return;
            }
            
            const medicines = getMedicines();
            
            if (currentEditId) {
                // Edit existing medicine
                const index = medicines.findIndex(m => m.id === currentEditId);
                if (index !== -1) {
                    medicines[index] = {
                        ...medicines[index],
                        name,
                        dosage,
                        time,
                        for: forCondition,
                        schedule: selectedSchedule
                    };
                    alertSystem.showAlert('success', 'Medicine updated successfully');
                }
            } else {
                // Add new medicine
                const newMedicine = {
                    id: Date.now(),
                    name,
                    dosage,
                    time,
                    for: forCondition,
                    schedule: selectedSchedule,
                    status: 'active'
                };
                medicines.push(newMedicine);
                alertSystem.showAlert('success', 'Medicine added successfully');
            }
            
            saveMedicines(medicines);
            closeAddMedicineModal();
        }

        // Bottom Navigation Functions
        document.querySelectorAll('.nav-item:not(.add-btn)').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                const page = this.getAttribute('data-page');
                switch(page) {
                    case 'home':
                        // Already on home page
                        break;
                    case 'tracker':
                        openMedicineTrackerModal();
                        break;
                    case 'health':
                        openHealthSummaryModal();
                        break;
                    case 'profile':
                        openSettingsModal();
                        break;
                }
            });
        });

        // Schedule button handlers
        document.querySelectorAll('.schedule-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const day = this.getAttribute('data-day');
                
                if (day === 'daily') {
                    selectedSchedule = ['daily'];
                    document.querySelectorAll('.schedule-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                } else {
                    if (selectedSchedule.includes('daily')) {
                        selectedSchedule = [];
                        document.querySelector('.schedule-btn[data-day="daily"]').classList.remove('selected');
                    }
                    
                    this.classList.toggle('selected');
                    
                    if (this.classList.contains('selected')) {
                        if (!selectedSchedule.includes(day)) {
                            selectedSchedule.push(day);
                        }
                    } else {
                        selectedSchedule = selectedSchedule.filter(d => d !== day);
                    }
                    
                    if (selectedSchedule.length === 0) {
                        selectedSchedule = ['daily'];
                        document.querySelector('.schedule-btn[data-day="daily"]').classList.add('selected');
                    }
                }
                
                updateScheduleDisplay();
            });
        });

        // DOM Elements
        const navbarToggle = document.getElementById('navbarToggle');
        const navbar = document.getElementById('navbar');
        const mainContent = document.getElementById('mainContent');
        const moodButtons = document.getElementById('moodButtons');
        const healthTips = document.getElementById('healthTips');
        const prescriptionBtn = document.getElementById('prescriptionBtn');
        const prescriptionModal = document.getElementById('prescriptionModal');
        const closeModal = document.getElementById('closeModal');
        const uploadArea = document.getElementById('uploadArea');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileInput = document.getElementById('fileInput');
        const scannedResults = document.getElementById('scannedResults');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const addMedicineBtn = document.getElementById('addMedicineBtn');
        const medicationTrackerBtn = document.getElementById('medicationTrackerBtn');
        const medicineTimerBtn = document.getElementById('medicineTimerBtn');
        const healthSummaryBtn = document.getElementById('healthSummaryBtn');
        const symptomCheckerBtn = document.getElementById('symptomCheckerBtn');
        const doctorConsultationBtn = document.getElementById('doctorConsultationBtn');
        const settingsModal = document.getElementById('settingsModal');

        // Feature functions (remain the same as your original code)
        function openMedicineTimerModal() {
            const medicineTimerModal = document.getElementById('medicineTimerModal');
            medicineTimerModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Update display
            medicineTimer.updateNextMedicine();
            medicineTimer.updateMedicineList();
            
            // Update button states
            document.getElementById('startTimerBtn').disabled = medicineTimer.timerRunning;
            document.getElementById('stopTimerBtn').disabled = !medicineTimer.timerRunning;
            document.getElementById('timerStatus').textContent = medicineTimer.timerRunning ? 
                'Timer is running - Monitoring medicines' : 'Timer is not running';
        }

        function closeMedicineTimerModal() {
            const medicineTimerModal = document.getElementById('medicineTimerModal');
            medicineTimerModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function startMedicineTimer() {
            medicineTimer.startTimer();
        }

        function stopMedicineTimer() {
            medicineTimer.stopTimer();
        }

        function checkForDueMedicines() {
            const medicines = getMedicines();
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
            
            let foundDue = false;
            
            medicines.forEach(medicine => {
                if (!medicine.time) return;
                
                const [hours, minutes] = medicine.time.split(':').map(Number);
                const medicineTime = hours * 60 + minutes;
                const schedule = medicine.schedule || ['daily'];
                
                if ((schedule.includes('daily') || schedule.includes(today)) && 
                    Math.abs(medicineTime - currentTime) <= 5) { // Within 5 minutes
                    alertSystem.showMedicineReminder(medicine);
                    foundDue = true;
                }
            });
            
            if (!foundDue) {
                alertSystem.showAlert('info', 'No Due Medicines', 'No medicines are due within the next 5 minutes.', 3000);
            }
            
            // Update display
            medicineTimer.updateMedicineList();
        }

        function openHealthSummaryModal() {
            const healthSummaryModal = document.getElementById('healthSummaryModal');
            healthSummaryModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            loadHealthSummaryData();
        }

        function closeHealthSummaryModal() {
            const healthSummaryModal = document.getElementById('healthSummaryModal');
            healthSummaryModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Destroy charts to free memory
            if (adherenceChart) {
                adherenceChart.destroy();
                adherenceChart = null;
            }
            if (medicineDistributionChart) {
                medicineDistributionChart.destroy();
                medicineDistributionChart = null;
            }
        }

        // Medicine Tracker Modal Functions
        function openMedicineTrackerModal() {
            const medicineTrackerModal = document.getElementById('medicineTrackerModal');
            medicineTrackerModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            loadMedicineTrackerData();
        }

        function closeMedicineTrackerModal() {
            const medicineTrackerModal = document.getElementById('medicineTrackerModal');
            medicineTrackerModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function loadMedicineTrackerData() {
            const medicines = getMedicines();
            const tracker = JSON.parse(localStorage.getItem('medigear_tracker') || '{}');
            const trackerView = document.getElementById('trackerView');
            
            if (medicines.length === 0) {
                trackerView.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-medium);">
                        <i class="fas fa-pills" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                        <h3 style="color: var(--text-dark); margin-bottom: 10px;">No Medicines Added</h3>
                        <p style="margin-bottom: 20px;">Add medicines to track your medication schedule</p>
                        <button class="form-btn primary" onclick="openAddMedicineFromTracker()" style="margin-top: 10px;">
                            <i class="fas fa-plus-circle"></i> Add Medicine
                        </button>
                    </div>
                `;
                return;
            }
            
            // Get today's day
            const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toLowerCase();
            
            // Filter medicines for today
            const todayMedicines = medicines.filter(medicine => {
                const schedule = medicine.schedule || ['daily'];
                return schedule.includes('daily') || schedule.includes(today);
            });
            
            // Sort by time
            todayMedicines.sort((a, b) => {
                if (!a.time) return 1;
                if (!b.time) return -1;
                return a.time.localeCompare(b.time);
            });
            
            let html = `
                <div style="margin-bottom: 20px; padding: 15px; background: var(--glass-bg); border-radius: 12px;">
                    <h3 style="color: var(--text-dark); margin-bottom: 10px;">Today's Medicines</h3>
                    <p style="color: var(--text-medium); font-size: 0.9rem;">
                        <i class="fas fa-info-circle" style="color: var(--info-color);"></i>
                        Check off medicines as you take them
                    </p>
                </div>
            `;
            
            if (todayMedicines.length === 0) {
                html += `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-medium);">
                        <i class="fas fa-calendar-check" style="font-size: 2.5rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <h4 style="color: var(--text-dark); margin-bottom: 10px;">No Medicines Scheduled Today</h4>
                        <p>Check back tomorrow or edit medicine schedules</p>
                    </div>
                `;
            } else {
                // Create a table for medicines
                html += `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <thead>
                                <tr style="background: var(--glass-bg); border-bottom: 2px solid var(--glass-border);">
                                    <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Medicine</th>
                                    <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Dosage</th>
                                    <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Time</th>
                                    <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Status</th>
                                    <th style="padding: 12px 15px; text-align: left; color: var(--text-dark); font-weight: 600;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                todayMedicines.forEach((medicine) => {
                    const isTaken = tracker[`medicine_${medicine.id}`] === true;
                    const status = isTaken ? 'Taken' : 'Pending';
                    const statusColor = isTaken ? 'var(--success-color)' : 'var(--warning-color)';
                    const statusIcon = isTaken ? 'fa-check-circle' : 'fa-clock';
                    
                    html += `
                        <tr style="border-bottom: 1px solid var(--glass-border-light); transition: all 0.3s ease;">
                            <td style="padding: 12px 15px;">
                                <div style="font-weight: 600; color: var(--text-dark);">${medicine.name}</div>
                                <div style="font-size: 0.85rem; color: var(--text-medium);">${medicine.for || 'General'}</div>
                            </td>
                            <td style="padding: 12px 15px; color: var(--text-dark); font-weight: 500;">${medicine.dosage}</td>
                            <td style="padding: 12px 15px;">
                                <div style="display: inline-block; background: linear-gradient(135deg, var(--soft-lavender-blue), var(--blush-pink)); color: white; padding: 5px 12px; border-radius: 20px; font-weight: 600; font-size: 0.85rem;">
                                    ${medicine.time || 'Not set'}
                                </div>
                            </td>
                            <td style="padding: 12px 15px;">
                                <div style="display: flex; align-items: center; gap: 8px; color: ${statusColor}; font-weight: 600;">
                                    <i class="fas ${statusIcon}"></i>
                                    ${status}
                                </div>
                            </td>
                            <td style="padding: 12px 15px;">
                                <div style="display: flex; gap: 8px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; background: var(--glass-bg); border-radius: 8px; transition: all 0.3s ease;">
                                        <input type="checkbox" ${isTaken ? 'checked' : ''} 
                                               onchange="toggleMedicineStatus(${medicine.id}, this.checked)"
                                               style="width: 18px; height: 18px; cursor: pointer;">
                                        <span style="font-size: 0.85rem; font-weight: 500;">Mark as taken</span>
                                    </label>
                                    <button class="action-icon-btn edit-btn" onclick="editMedicineFromTracker(${medicine.id})" title="Edit" style="width: 36px; height: 36px;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                // Add summary statistics
                const takenCount = todayMedicines.filter(med => tracker[`medicine_${med.id}`] === true).length;
                const totalCount = todayMedicines.length;
                const percentage = totalCount > 0 ? Math.round((takenCount / totalCount) * 100) : 0;
                
                html += `
                    <div style="background: var(--glass-bg); border-radius: 12px; padding: 15px; margin-top: 20px; border: 1px solid var(--glass-border);">
                        <h4 style="color: var(--text-dark); margin-bottom: 10px;">Today's Progress</h4>
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <div style="height: 10px; background: var(--glass-border); border-radius: 5px; overflow: hidden;">
                                    <div style="height: 100%; width: ${percentage}%; background: linear-gradient(90deg, var(--success-color), var(--info-color)); transition: width 0.5s ease;"></div>
                                </div>
                            </div>
                            <div style="font-weight: 600; color: var(--text-dark);">
                                ${takenCount}/${totalCount} (${percentage}%)
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <div style="text-align: center; padding: 10px; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--success-color);">${takenCount}</div>
                                <div style="font-size: 0.85rem; color: var(--text-medium);">Taken</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: rgba(245, 158, 11, 0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--warning-color);">${totalCount - takenCount}</div>
                                <div style="font-size: 0.85rem; color: var(--text-medium);">Pending</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add all medicines section
                html += `
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--glass-border);">
                        <h3 style="color: var(--text-dark); margin-bottom: 15px;">All Medicines</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                `;
                
                medicines.forEach((medicine) => {
                    const isTaken = tracker[`medicine_${medicine.id}`] === true;
                    const bgColor = isTaken ? 'rgba(16, 185, 129, 0.1)' : 'var(--glass-bg)';
                    const borderColor = isTaken ? 'rgba(16, 185, 129, 0.3)' : 'var(--glass-border)';
                    
                    html += `
                        <div style="flex: 1; min-width: 200px; background: ${bgColor}; border: 1px solid ${borderColor}; border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <div style="font-weight: 600; color: var(--text-dark);">${medicine.name}</div>
                                    <div style="font-size: 0.85rem; color: var(--text-medium); margin-top: 5px;">
                                        <i class="fas fa-clock" style="margin-right: 5px;"></i> ${medicine.time || 'Not set'}
                                    </div>
                                </div>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                    <input type="checkbox" ${isTaken ? 'checked' : ''} 
                                           onchange="toggleMedicineStatus(${medicine.id}, this.checked)"
                                           style="width: 18px; height: 18px; cursor: pointer;">
                                </label>
                            </div>
                            <div style="display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap;">
                                <span style="font-size: 0.75rem; padding: 3px 8px; background: var(--glass-bg-light); border-radius: 12px; color: var(--text-medium);">
                                    ${medicine.dosage}
                                </span>
                                ${medicine.schedule && medicine.schedule.length > 0 ? `
                                    <span style="font-size: 0.75rem; padding: 3px 8px; background: var(--glass-bg-light); border-radius: 12px; color: var(--text-medium);">
                                        ${medicine.schedule.includes('daily') ? 'Daily' : medicine.schedule.join(', ')}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            trackerView.innerHTML = html;
        }

        // FIXED: Function to open add medicine from tracker modal
        function openAddMedicineFromTracker() {
            closeMedicineTrackerModal(); // Close tracker modal first
            setTimeout(() => {
                openAddMedicineModal(); // Then open add medicine modal
            }, 300);
        }

        // FIXED: Function to edit medicine from tracker modal
        function editMedicineFromTracker(id) {
            closeMedicineTrackerModal(); // Close tracker modal first
            setTimeout(() => {
                editMedicine(id); // Then open edit medicine modal
            }, 300);
        }

        function toggleMedicineStatus(id, status) {
            const tracker = JSON.parse(localStorage.getItem('medigear_tracker') || '{}');
            tracker[`medicine_${id}`] = status;
            localStorage.setItem('medigear_tracker', JSON.stringify(tracker));
            
            // Show notification
            if (status) {
                const medicines = getMedicines();
                const medicine = medicines.find(m => m.id === id);
                if (medicine) {
                    alertSystem.showAlert('success', 'Medicine Taken', 
                        `Marked "${medicine.name}" as taken! Keep up the good work.`, 3000);
                }
                
                // Update streak if medicine was taken
                updateDayStreak();
            }
            
            // Refresh the tracker view
            loadMedicineTrackerData();
            
            // Update display if timer modal is open
            if (document.getElementById('medicineTimerModal').classList.contains('active')) {
                medicineTimer.updateMedicineList();
            }
        }

        function updateDayStreak() {
            const today = new Date().toDateString();
            const lastMedicationDate = localStorage.getItem('medigear_last_medication_date');
            
            if (lastMedicationDate !== today) {
                let streak = parseInt(localStorage.getItem('medigear_day_streak') || '0');
                
                // Only increment if we haven't already today
                if (lastMedicationDate !== today) {
                    streak++;
                    localStorage.setItem('medigear_day_streak', streak.toString());
                    localStorage.setItem('medigear_last_medication_date', today);
                    
                    // Update dashboard
                    document.getElementById('daysStreak').textContent = streak;
                    
                    // Show streak notification every 7 days
                    if (streak % 7 === 0) {
                        alertSystem.showAlert('success', ' Streak Milestone!', 
                            `Amazing! You've maintained a ${streak}-day medication streak!`, 5000);
                    }
                }
            }
        }

        // AI Symptom Checker Functions
        function openSymptomCheckerModal() {
            const modal = document.getElementById('symptomCheckerModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            initializeSymptomChecker();
        }

        function closeSymptomCheckerModal() {
            const modal = document.getElementById('symptomCheckerModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function initializeSymptomChecker() {
            selectedSymptoms = [];
            const symptomPills = document.querySelectorAll('#symptomCheckerModal .symptom-pill');
            
            symptomPills.forEach(pill => {
                pill.classList.remove('selected');
                pill.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    const symptomName = this.textContent.trim();
                    
                    if (this.classList.contains('selected')) {
                        if (!selectedSymptoms.includes(symptomName)) {
                            selectedSymptoms.push(symptomName);
                        }
                    } else {
                        selectedSymptoms = selectedSymptoms.filter(s => s !== symptomName);
                    }
                });
            });
        }

        function moveToSymptomStep(stepNum) {
            // Hide all step contents
            document.getElementById('symptomStep1Content').style.display = 'none';
            document.getElementById('symptomStep2Content').style.display = 'none';
            document.getElementById('symptomStep3Content').style.display = 'none';

            // Remove active class from all steps
            document.getElementById('symptomStep1').classList.remove('active');
            document.getElementById('symptomStep2').classList.remove('active');
            document.getElementById('symptomStep3').classList.remove('active');
            document.getElementById('symptomBar1').classList.remove('active');
            document.getElementById('symptomBar2').classList.remove('active');

            // Show current step
            if (stepNum === 1) {
                document.getElementById('symptomStep1Content').style.display = 'block';
                document.getElementById('symptomStep1').classList.add('active');
            } else if (stepNum === 2) {
                document.getElementById('symptomStep2Content').style.display = 'block';
                document.getElementById('symptomStep1').classList.add('active');
                document.getElementById('symptomStep2').classList.add('active');
                document.getElementById('symptomBar1').classList.add('active');
                
                const list = document.getElementById('selectedSymptomsList');
                list.innerHTML = selectedSymptoms.map(s => `<li style="padding: 8px; background: var(--glass-bg-light); border-radius: 6px; list-style: none;"> ${s}</li>`).join('');
            } else if (stepNum === 3) {
                document.getElementById('symptomStep3Content').style.display = 'block';
                document.getElementById('symptomStep1').classList.add('active');
                document.getElementById('symptomStep2').classList.add('active');
                document.getElementById('symptomStep3').classList.add('active');
                document.getElementById('symptomBar1').classList.add('active');
                document.getElementById('symptomBar2').classList.add('active');
                
                performSymptomAnalysisFixed();
            }
        }

        function performSymptomAnalysisFixed() {
            const diseaseMatches = [];

            for (const [disease, data] of Object.entries(diagnosisRules)) {
                const matchCount = data.symptoms.filter(s => selectedSymptoms.includes(s)).length;
                if (matchCount > 0) {
                    const score = Math.round((matchCount / data.symptoms.length) * 100);
                    diseaseMatches.push({ disease, score, remedies: data.remedies, urgency: data.urgency });
                }
            }

            diseaseMatches.sort((a, b) => b.score - a.score);
            const resultsDiv = document.getElementById('symptomResults');

            if (diseaseMatches.length === 0) {
                resultsDiv.innerHTML = '<p style="text-align: center; color: var(--text-medium); font-size: 1.1rem;"> No clear match found. Please consult a doctor for a proper diagnosis.</p>';
                return;
            }

            let resultsHtml = '<p style="margin-bottom: 20px; color: var(--text-medium);">Possible conditions based on your symptoms:</p>';

            diseaseMatches.slice(0, 3).forEach(function(match) {
                const urgencyClass = 'urgency-' + match.urgency.toLowerCase();
                resultsHtml += '<div class="diagnosis-item">'
                    + '<div class="diagnosis-title">'
                        + match.disease
                        + '<span class="urgency-badge ' + urgencyClass + '">' + match.urgency + '</span>'
                        + '<span style="color: var(--accent-color); margin-left: 10px;">' + match.score + '% match</span>'
                    + '</div>'
                    + '<div class="diagnosis-remedies">'
                        + '<strong>Suggested Remedies:</strong>'
                        + '<ul style="margin-top: 8px; padding-left: 20px;">'
                            + match.remedies.map(function(r) { return '<li>' + r + '</li>'; }).join('')
                        + '</ul>'
                    + '</div>'
                + '</div>';
            });

            resultsHtml += '<p style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--glass-border); color: var(--text-light); font-size: 0.9rem;">'
                + '<strong> Medical Disclaimer:</strong> This AI symptom checker provides only preliminary health information and must not replace professional medical advice, diagnosis, or treatment. Always consult with a qualified doctor for medical concerns.</p>';

            resultsDiv.innerHTML = resultsHtml;
        }

        // Settings Modal Functions
        function openSettingsModal() {
            settingsModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            loadProfileData();
            loadThemeSelection();
            loadCaregiverSettings();
        }

        function closeSettingsModal() {
            settingsModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function loadProfileData() {
            const profileData = JSON.parse(localStorage.getItem('medigear_profile') || '{}');
            
            document.getElementById('profileName').value = profileData.name || '';
            document.getElementById('profileEmail').value = profileData.email || '';
            document.getElementById('profilePhone').value = profileData.phone || '';
            document.getElementById('profileDob').value = profileData.dob || '';
            document.getElementById('profileGender').value = profileData.gender || '';
        }

        function saveProfile() {
            const profileData = {
                name: document.getElementById('profileName').value.trim(),
                email: document.getElementById('profileEmail').value.trim(),
                phone: document.getElementById('profilePhone').value.trim(),
                dob: document.getElementById('profileDob').value,
                gender: document.getElementById('profileGender').value
            };
            
            localStorage.setItem('medigear_profile', JSON.stringify(profileData));
            
            // Update user display
            if (profileData.name) {
                document.getElementById('userName').textContent = profileData.name;
                document.getElementById('userAvatar').textContent = profileData.name.charAt(0).toUpperCase();
                document.getElementById('welcomeMessage').textContent = `Welcome back, ${profileData.name.split(' ')[0]}! `;
                localStorage.setItem('medigear_username', profileData.name);
            }
            
            alertSystem.showAlert('success', 'Profile Updated', 'Your profile has been updated successfully!', 3000);
            closeSettingsModal();
        }

        function loadThemeSelection() {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.theme-option[data-theme="${currentTheme}"]`).classList.add('selected');
        }

        function loadCaregiverSettings() {
            const caregiverSettings = JSON.parse(localStorage.getItem('medigear_caregiver') || '{}');
            
            document.getElementById('caregiverName').value = caregiverSettings.name || '';
            document.getElementById('caregiverEmail').value = caregiverSettings.email || '';
            document.getElementById('caregiverPhone').value = caregiverSettings.phone || '';
            document.getElementById('caregiverAlertsEnabled').checked = caregiverSettings.enabled || false;
            document.getElementById('alertMedicineReminder').checked = caregiverSettings.alertMedicineReminder !== false;
            document.getElementById('alertMissedDose').checked = caregiverSettings.alertMissedDose !== false;
            document.getElementById('alertEmergency').checked = caregiverSettings.alertEmergency !== false;
        }

        function saveCaregiverSettings() {
            const caregiverSettings = {
                name: document.getElementById('caregiverName').value.trim(),
                email: document.getElementById('caregiverEmail').value.trim(),
                phone: document.getElementById('caregiverPhone').value.trim(),
                enabled: document.getElementById('caregiverAlertsEnabled').checked,
                alertMedicineReminder: document.getElementById('alertMedicineReminder').checked,
                alertMissedDose: document.getElementById('alertMissedDose').checked,
                alertEmergency: document.getElementById('alertEmergency').checked
            };
            
            localStorage.setItem('medigear_caregiver', JSON.stringify(caregiverSettings));
            
            alertSystem.showAlert('success', 'Caregiver Settings Saved', 'Caregiver settings have been updated successfully!', 3000);
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab button
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Show active tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId + 'Tab').classList.add('active');
            });
        });

        // Initialize mood selection
        function initializeMoodSelection() {
            moodButtons.innerHTML = '';
            
            moodData.forEach(mood => {
                const button = document.createElement('button');
                button.className = 'mood-btn';
                button.innerHTML = `
                    <div class="mood-emoji">${mood.emoji}</div>
                    <div class="mood-name">${mood.mood}</div>
                `;
                button.style.setProperty('--mood-color', mood.color);
                
                button.addEventListener('click', () => handleMoodSelection(mood));
                moodButtons.appendChild(button);
            });
            
            // Check if already checked in today
            const lastCheckin = localStorage.getItem('lastMoodCheckin');
            const today = new Date().toDateString();
            
            if (lastCheckin === today) {
                const lastMood = localStorage.getItem('lastMood');
                if (lastMood) {
                    showWelcomeBackMessage(lastMood);
                }
            }
        }

        // Handle mood selection
        function handleMoodSelection(selectedMood) {
            // Update UI
            moodButtons.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.querySelector('.mood-name').textContent === selectedMood.mood) {
                    btn.classList.add('selected');
                }
            });
            
            // Save mood
            localStorage.setItem('lastMoodCheckin', new Date().toDateString());
            localStorage.setItem('lastMood', selectedMood.mood);
            
            // Show health tips
            showHealthTips(selectedMood);
        }

        // Show health tips
        function showHealthTips(mood) {
            healthTips.style.display = 'block';
            healthTips.innerHTML = `
                <h4 style="color: var(--text-dark); margin-bottom: 15px; font-size: 1.1rem;">Health Tips for ${mood.mood} Days</h4>
                ${mood.tips.map(tip => `
                    <div class="health-tip">
                        <i class="fas fa-lightbulb"></i>
                        <span>${tip}</span>
                    </div>
                `).join('')}
            `;
        }

        // Show welcome back message
        function showWelcomeBackMessage(lastMood) {
            const mood = moodData.find(m => m.mood === lastMood) || moodData[0];
            
            moodButtons.querySelectorAll('.mood-btn').forEach(btn => {
                if (btn.querySelector('.mood-name').textContent === lastMood) {
                    btn.classList.add('selected');
                }
            });
            
            showHealthTips(mood);
        }

        // Initialize prescription scanner
        function initializePrescriptionScanner() {
            // Open modal
            prescriptionBtn.addEventListener('click', () => {
                prescriptionModal.classList.add('active');
                document.body.style.overflow = 'hidden';
                // Reset upload area visibility
                uploadArea.style.display = 'block';
                scannedResults.classList.remove('active');
                scannedResults.innerHTML = '';
                fileInput.value = '';
            });
            
            // Close modal
            closeModal.addEventListener('click', closePrescriptionModal);
            prescriptionModal.addEventListener('click', (e) => {
                if (e.target === prescriptionModal) {
                    closePrescriptionModal();
                }
            });
            
            // File upload
            uploadBtn.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', handleFileUpload);
            
            // Drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                uploadArea.classList.add('dragover');
            }
            
            function unhighlight() {
                uploadArea.classList.remove('dragover');
            }
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
        }

        // Handle file upload
        function handleFileUpload(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        // Handle files
        function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
            
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid file (JPG, PNG, or PDF)');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                alert('File size must be less than 10MB');
                return;
            }
            
            // Show loading
            loadingOverlay.classList.add('active');
            
            // Simulate scanning process
            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                showScannedResults();
            }, 2000);
        }

        // Show scanned results
        function showScannedResults() {
            const sampleResults = [
                {
                    name: "Metformin Hydrochloride",
                    dosage: "500 mg",
                    frequency: "Twice daily (Morning & Evening)",
                    duration: "30 days",
                    instructions: "Take with meals. May cause stomach upset.",
                    purpose: "Diabetes Management",
                    warnings: "Monitor blood sugar regularly. Avoid alcohol."
                },
                {
                    name: "Atorvastatin Calcium",
                    dosage: "20 mg",
                    frequency: "Once daily (At bedtime)",
                    duration: "30 days",
                    instructions: "Take at bedtime. Do not crush or chew.",
                    purpose: "Cholesterol Control",
                    warnings: "Report muscle pain or weakness immediately."
                }
            ];
            
            // Hide upload area
            uploadArea.style.display = 'none';
            
            scannedResults.innerHTML = `
                <h3 style="color: var(--text-dark); margin-bottom: 20px;">Scanned Medicines (${sampleResults.length} found)</h3>
                ${sampleResults.map((medicine, index) => `
                    <div class="result-item">
                        <div class="result-header">
                            <div class="medicine-icon">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="result-details">
                                <h4>${medicine.name}</h4>
                                <p>${medicine.purpose}</p>
                            </div>
                            <div class="medicine-time">${medicine.dosage}</div>
                        </div>
                        <div class="result-info">
                            <div class="info-item">
                                <span class="info-label">Frequency</span>
                                <span class="info-value">${medicine.frequency}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Duration</span>
                                <span class="info-value">${medicine.duration}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Instructions</span>
                                <span class="info-value">${medicine.instructions}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Warnings</span>
                                <span class="info-value" style="color: var(--warning-color);">${medicine.warnings}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
                <div style="margin-top: 20px; display: flex; gap: 15px;">
                    <button class="form-btn primary" onclick="addAllToTracker()">
                        <i class="fas fa-plus-circle"></i> Add All to Tracker
                    </button>
                    <button class="form-btn secondary" onclick="scanAnother()">
                        <i class="fas fa-file-upload"></i> Scan Another
                    </button>
                    <button class="form-btn secondary" onclick="closePrescriptionModal()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            `;
            
            scannedResults.classList.add('active');
        }

        // Scan another prescription
        function scanAnother() {
            // Show upload area again
            uploadArea.style.display = 'block';
            scannedResults.classList.remove('active');
            scannedResults.innerHTML = '';
            fileInput.value = '';
        }

        // Close prescription modal
        function closePrescriptionModal() {
            prescriptionModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Reset everything
            uploadArea.style.display = 'block';
            scannedResults.classList.remove('active');
            scannedResults.innerHTML = '';
            fileInput.value = '';
            loadingOverlay.classList.remove('active');
        }

        // Add all to tracker
        function addAllToTracker() {
            // Get current medicines
            const medicines = getMedicines();
            
            // Add scanned medicines (simulated)
            const newMedicines = [
                {
                    id: Date.now() + 1,
                    name: "Metformin Hydrochloride",
                    dosage: "500 mg",
                    time: "08:00",
                    for: "Diabetes Management",
                    schedule: ['daily'],
                    status: 'active'
                },
                {
                    id: Date.now() + 2,
                    name: "Atorvastatin Calcium",
                    dosage: "20 mg",
                    time: "20:00",
                    for: "Cholesterol Control",
                    schedule: ['daily'],
                    status: 'active'
                }
            ];
            
            // Add new medicines
            newMedicines.forEach(medicine => {
                medicines.push(medicine);
            });
            
            // Save updated medicines
            saveMedicines(medicines);
            
            alertSystem.showAlert('success', 'Medicines Added', 'All medicines have been added to your tracker!', 3000);
            closePrescriptionModal();
        }

        // Initialize dashboard
        function initializeDashboard() {
            // Check authentication first
            if (!checkAuthentication()) {
                return;
            }
            
            // Initialize navbar
            initializeNavbar();
            
            // Initialize mood selection
            initializeMoodSelection();
            
            // Initialize prescription scanner
            initializePrescriptionScanner();
            
            // Initialize medicine buttons
            initializeMedicineButtons();
            
            // Update dashboard
            updateMedicineList();
            updateDashboardStats();
            
            // Start medicine timer automatically
            medicineTimer.startTimer();
            
            // Bottom navigation event listeners
            document.querySelectorAll('.bottom-nav .nav-item:not(.add-btn)').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.bottom-nav .nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Initialize navbar
        function initializeNavbar() {
            let navbarOpen = false;
            
            navbarToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                navbarOpen = !navbarOpen;
                navbar.classList.toggle('active');
                navbarToggle.classList.toggle('active');
                
                // Toggle the arrow direction
                const icon = navbarToggle.querySelector('i');
                if (navbarOpen) {
                    icon.classList.remove('fa-chevron-right');
                    icon.classList.add('fa-chevron-left');
                    mainContent.classList.add('with-navbar');
                } else {
                    icon.classList.remove('fa-chevron-left');
                    icon.classList.add('fa-chevron-right');
                    mainContent.classList.remove('with-navbar');
                    navbarOpen = false;
                }
            });

            // Prevent main content scrolling when hovering over navbar
            navbar.addEventListener('mouseenter', () => {
                document.body.style.overflow = 'hidden';
            });

            navbar.addEventListener('mouseleave', () => {
                document.body.style.overflow = 'auto';
            });

            // Close navbar when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.navbar') && 
                    !e.target.closest('.navbar-toggle') && 
                    navbarOpen) {
                    navbar.classList.remove('active');
                    navbarToggle.classList.remove('active');
                    navbarToggle.querySelector('i').classList.remove('fa-chevron-left');
                    navbarToggle.querySelector('i').classList.add('fa-chevron-right');
                    mainContent.classList.remove('with-navbar');
                    navbarOpen = false;
                }
            });

            // Add click handlers for nav links
            const navLinks = document.querySelectorAll('.nav-links a');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    if (link.getAttribute('href') === '#') {
                        e.preventDefault();
                    }
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    // Close navbar on mobile after clicking a link
                    if (window.innerWidth < 992) {
                        navbar.classList.remove('active');
                        navbarToggle.classList.remove('active');
                        navbarToggle.querySelector('i').classList.remove('fa-chevron-left');
                        navbarToggle.querySelector('i').classList.add('fa-chevron-right');
                        mainContent.classList.remove('with-navbar');
                        navbarOpen = false;
                    }
                });
            });
        }

        // Initialize medicine buttons
        function initializeMedicineButtons() {
            // Add medicine button
            addMedicineBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openAddMedicineModal();
            });
            
            // Medication tracker button
            medicationTrackerBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openMedicineTrackerModal();
            });
            
            // Medicine timer button
            medicineTimerBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openMedicineTimerModal();
            });
            
            // Health summary button
            healthSummaryBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openHealthSummaryModal();
            });
            
            // Symptom checker button
            symptomCheckerBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openSymptomCheckerModal();
            });
            
            // Doctor consultation button
            doctorConsultationBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openDoctorConsultationModal();
            });
        }

        // Event listeners for symptom checker buttons
        document.getElementById('symptomNextStep1').addEventListener('click', function() {
            if (selectedSymptoms.length === 0) {
                alert('Please select at least one symptom!');
                return;
            }
            moveToSymptomStep(2);
        });

        document.getElementById('symptomBackStep2').addEventListener('click', function() {
            moveToSymptomStep(1);
        });

        document.getElementById('symptomNextStep2').addEventListener('click', function() {
            moveToSymptomStep(3);
        });

        document.getElementById('symptomRestartBtn').addEventListener('click', function() {
            moveToSymptomStep(1);
            selectedSymptoms = [];
            document.querySelectorAll('#symptomCheckerModal .symptom-pill').forEach(pill => {
                pill.classList.remove('selected');
            });
        });

        // Start loading screen when page loads
        document.addEventListener('DOMContentLoaded', function() {
            showLoadingScreen();
        });

        // Close modal on outside click
        document.getElementById('addMedicineModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAddMedicineModal();
            }
        });
    </script>

    <!-- Chatbot Widget Initialization -->
    <script>
    (function () {
      function initChatbot() {
        if (window.__CHATBOT_INITIALIZED) return;
        window.__CHATBOT_INITIALIZED = true;

        try {
          const cfg = window.CHATBOT_CONFIG || {};

          const vapiWidget = document.createElement('vapi-widget');
          if (cfg.assistantId) vapiWidget.setAttribute('assistant-id', cfg.assistantId);
          if (cfg.publicKey) vapiWidget.setAttribute('public-key', cfg.publicKey);
          vapiWidget.setAttribute('cta-title', ' MediGearBot');
          vapiWidget.setAttribute('size', 'compact');
          vapiWidget.setAttribute('mode', 'chat');
          vapiWidget.setAttribute('voice-show-transcript', 'true');
          vapiWidget.setAttribute('title', 'MediGearBot - Your Healthcare Assistant');

          document.body.appendChild(vapiWidget);

          const script = document.createElement('script');
          script.src = 'https://static.readdy.ai/assistant/widget.umd.js';
          script.async = true;

          script.addEventListener('error', () => {
            console.warn('Widget script failed to load  showing iframe fallback.');
            const el = document.getElementById('chatbot-container');
            if (el) el.style.display = 'block';
          });

          document.body.appendChild(script);
        } catch (e) {
          console.error('Error initializing chatbot widget:', e);
          const el = document.getElementById('chatbot-container');
          if (el) el.style.display = 'block';
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initChatbot);
      } else {
        initChatbot();
      }

      window.openMediGearBotFallback = function () {
        const el = document.getElementById('chatbot-container');
        if (el) el.style.display = 'block';
      };
    })();
    </script>
</body>
</html>